\hypertarget{minimp3__ex_8h_source}{}\doxysection{minimp3\+\_\+ex.\+h}
\label{minimp3__ex_8h_source}\index{cmake-\/build-\/debug/\_deps/sfml-\/src/extlibs/headers/minimp3/minimp3\_ex.h@{cmake-\/build-\/debug/\_deps/sfml-\/src/extlibs/headers/minimp3/minimp3\_ex.h}}

\begin{DoxyCode}{0}
\DoxyCodeLine{1 \textcolor{preprocessor}{\#ifndef MINIMP3\_EXT\_H}}
\DoxyCodeLine{2 \textcolor{preprocessor}{\#define MINIMP3\_EXT\_H}}
\DoxyCodeLine{3 \textcolor{comment}{/*}}
\DoxyCodeLine{4 \textcolor{comment}{    https://github.com/lieff/minimp3}}
\DoxyCodeLine{5 \textcolor{comment}{    To the extent possible under law, the author(s) have dedicated all copyright and related and neighboring rights to this software to the public domain worldwide.}}
\DoxyCodeLine{6 \textcolor{comment}{    This software is distributed without any warranty.}}
\DoxyCodeLine{7 \textcolor{comment}{    See <http://creativecommons.org/publicdomain/zero/1.0/>.}}
\DoxyCodeLine{8 \textcolor{comment}{*/}}
\DoxyCodeLine{9 \textcolor{preprocessor}{\#include <stddef.h>}}
\DoxyCodeLine{10 \textcolor{preprocessor}{\#include "{}minimp3.h"{}}}
\DoxyCodeLine{11 }
\DoxyCodeLine{12 \textcolor{comment}{/* flags for mp3dec\_ex\_open\_* functions */}}
\DoxyCodeLine{13 \textcolor{preprocessor}{\#define MP3D\_SEEK\_TO\_BYTE   0      }\textcolor{comment}{/* mp3dec\_ex\_seek seeks to byte in stream */}\textcolor{preprocessor}{}}
\DoxyCodeLine{14 \textcolor{preprocessor}{\#define MP3D\_SEEK\_TO\_SAMPLE 1      }\textcolor{comment}{/* mp3dec\_ex\_seek precisely seeks to sample using index (created during duration calculation scan or when mp3dec\_ex\_seek called) */}\textcolor{preprocessor}{}}
\DoxyCodeLine{15 \textcolor{preprocessor}{\#define MP3D\_DO\_NOT\_SCAN    2      }\textcolor{comment}{/* do not scan whole stream for duration if vbrtag not found, mp3dec\_ex\_t::samples will be filled only if mp3dec\_ex\_t::vbr\_tag\_found == 1 */}\textcolor{preprocessor}{}}
\DoxyCodeLine{16 \textcolor{preprocessor}{\#ifdef MINIMP3\_ALLOW\_MONO\_STEREO\_TRANSITION}}
\DoxyCodeLine{17 \textcolor{preprocessor}{\#define MP3D\_ALLOW\_MONO\_STEREO\_TRANSITION  4}}
\DoxyCodeLine{18 \textcolor{preprocessor}{\#define MP3D\_FLAGS\_MASK 7}}
\DoxyCodeLine{19 \textcolor{preprocessor}{\#else}}
\DoxyCodeLine{20 \textcolor{preprocessor}{\#define MP3D\_FLAGS\_MASK 3}}
\DoxyCodeLine{21 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{22 }
\DoxyCodeLine{23 \textcolor{comment}{/* compile-\/time config */}}
\DoxyCodeLine{24 \textcolor{preprocessor}{\#define MINIMP3\_PREDECODE\_FRAMES 2 }\textcolor{comment}{/* frames to pre-\/decode and skip after seek (to fill internal structures) */}\textcolor{preprocessor}{}}
\DoxyCodeLine{25 \textcolor{comment}{/*\#define MINIMP3\_SEEK\_IDX\_LINEAR\_SEARCH*/} \textcolor{comment}{/* define to use linear index search instead of binary search on seek */}}
\DoxyCodeLine{26 \textcolor{preprocessor}{\#define MINIMP3\_IO\_SIZE (128*1024) }\textcolor{comment}{/* io buffer size for streaming functions, must be greater than MINIMP3\_BUF\_SIZE */}\textcolor{preprocessor}{}}
\DoxyCodeLine{27 \textcolor{preprocessor}{\#define MINIMP3\_BUF\_SIZE (16*1024) }\textcolor{comment}{/* buffer which can hold minimum 10 consecutive mp3 frames (\string~16KB) worst case */}\textcolor{preprocessor}{}}
\DoxyCodeLine{28 \textcolor{comment}{/*\#define MINIMP3\_SCAN\_LIMIT (256*1024)*/} \textcolor{comment}{/* how many bytes will be scanned to search first valid mp3 frame, to prevent stall on large non-\/mp3 files */}}
\DoxyCodeLine{29 \textcolor{preprocessor}{\#define MINIMP3\_ENABLE\_RING 0      }\textcolor{comment}{/* WIP enable hardware magic ring buffer if available, to make less input buffer memmove(s) in callback IO mode */}\textcolor{preprocessor}{}}
\DoxyCodeLine{30 }
\DoxyCodeLine{31 \textcolor{comment}{/* return error codes */}}
\DoxyCodeLine{32 \textcolor{preprocessor}{\#define MP3D\_E\_PARAM   -\/1}}
\DoxyCodeLine{33 \textcolor{preprocessor}{\#define MP3D\_E\_MEMORY  -\/2}}
\DoxyCodeLine{34 \textcolor{preprocessor}{\#define MP3D\_E\_IOERROR -\/3}}
\DoxyCodeLine{35 \textcolor{preprocessor}{\#define MP3D\_E\_USER    -\/4  }\textcolor{comment}{/* can be used to stop processing from callbacks without indicating specific error */}\textcolor{preprocessor}{}}
\DoxyCodeLine{36 \textcolor{preprocessor}{\#define MP3D\_E\_DECODE  -\/5  }\textcolor{comment}{/* decode error which can't be safely skipped, such as sample rate, layer and channels change */}\textcolor{preprocessor}{}}
\DoxyCodeLine{37 }
\DoxyCodeLine{38 \textcolor{keyword}{typedef} \textcolor{keyword}{struct}}
\DoxyCodeLine{39 \{}
\DoxyCodeLine{40     mp3d\_sample\_t *buffer;}
\DoxyCodeLine{41     \textcolor{keywordtype}{size\_t} samples; \textcolor{comment}{/* channels included, byte size = samples*sizeof(mp3d\_sample\_t) */}}
\DoxyCodeLine{42     \textcolor{keywordtype}{int} channels, hz, layer, avg\_bitrate\_kbps;}
\DoxyCodeLine{43 \} \mbox{\hyperlink{structmp3dec__file__info__t}{mp3dec\_file\_info\_t}};}
\DoxyCodeLine{44 }
\DoxyCodeLine{45 \textcolor{keyword}{typedef} \textcolor{keyword}{struct}}
\DoxyCodeLine{46 \{}
\DoxyCodeLine{47     \textcolor{keyword}{const} uint8\_t *buffer;}
\DoxyCodeLine{48     \textcolor{keywordtype}{size\_t} size;}
\DoxyCodeLine{49 \} \mbox{\hyperlink{structmp3dec__map__info__t}{mp3dec\_map\_info\_t}};}
\DoxyCodeLine{50 }
\DoxyCodeLine{51 \textcolor{keyword}{typedef} \textcolor{keyword}{struct}}
\DoxyCodeLine{52 \{}
\DoxyCodeLine{53     uint64\_t sample;}
\DoxyCodeLine{54     uint64\_t offset;}
\DoxyCodeLine{55 \} \mbox{\hyperlink{structmp3dec__frame__t}{mp3dec\_frame\_t}};}
\DoxyCodeLine{56 }
\DoxyCodeLine{57 \textcolor{keyword}{typedef} \textcolor{keyword}{struct}}
\DoxyCodeLine{58 \{}
\DoxyCodeLine{59     \mbox{\hyperlink{structmp3dec__frame__t}{mp3dec\_frame\_t}} *frames;}
\DoxyCodeLine{60     \textcolor{keywordtype}{size\_t} num\_frames, capacity;}
\DoxyCodeLine{61 \} \mbox{\hyperlink{structmp3dec__index__t}{mp3dec\_index\_t}};}
\DoxyCodeLine{62 }
\DoxyCodeLine{63 \textcolor{keyword}{typedef} size\_t (*MP3D\_READ\_CB)(\textcolor{keywordtype}{void} *buf, \textcolor{keywordtype}{size\_t} size, \textcolor{keywordtype}{void} *user\_data);}
\DoxyCodeLine{64 \textcolor{keyword}{typedef} int (*MP3D\_SEEK\_CB)(uint64\_t position, \textcolor{keywordtype}{void} *user\_data);}
\DoxyCodeLine{65 }
\DoxyCodeLine{66 \textcolor{keyword}{typedef} \textcolor{keyword}{struct}}
\DoxyCodeLine{67 \{}
\DoxyCodeLine{68     MP3D\_READ\_CB read;}
\DoxyCodeLine{69     \textcolor{keywordtype}{void} *read\_data;}
\DoxyCodeLine{70     MP3D\_SEEK\_CB seek;}
\DoxyCodeLine{71     \textcolor{keywordtype}{void} *seek\_data;}
\DoxyCodeLine{72 \} \mbox{\hyperlink{structmp3dec__io__t}{mp3dec\_io\_t}};}
\DoxyCodeLine{73 }
\DoxyCodeLine{74 \textcolor{keyword}{typedef} \textcolor{keyword}{struct}}
\DoxyCodeLine{75 \{}
\DoxyCodeLine{76     \mbox{\hyperlink{structmp3dec__t}{mp3dec\_t}} mp3d;}
\DoxyCodeLine{77     \mbox{\hyperlink{structmp3dec__map__info__t}{mp3dec\_map\_info\_t}} file;}
\DoxyCodeLine{78     \mbox{\hyperlink{structmp3dec__io__t}{mp3dec\_io\_t}} *io;}
\DoxyCodeLine{79     \mbox{\hyperlink{structmp3dec__index__t}{mp3dec\_index\_t}} index;}
\DoxyCodeLine{80     uint64\_t offset, samples, detected\_samples, cur\_sample, start\_offset, end\_offset;}
\DoxyCodeLine{81     \mbox{\hyperlink{structmp3dec__frame__info__t}{mp3dec\_frame\_info\_t}} info;}
\DoxyCodeLine{82     mp3d\_sample\_t buffer[MINIMP3\_MAX\_SAMPLES\_PER\_FRAME];}
\DoxyCodeLine{83     \textcolor{keywordtype}{size\_t} input\_consumed, input\_filled;}
\DoxyCodeLine{84     \textcolor{keywordtype}{int} is\_file, flags, vbr\_tag\_found, indexes\_built;}
\DoxyCodeLine{85     \textcolor{keywordtype}{int} free\_format\_bytes;}
\DoxyCodeLine{86     \textcolor{keywordtype}{int} buffer\_samples, buffer\_consumed, to\_skip, start\_delay;}
\DoxyCodeLine{87     \textcolor{keywordtype}{int} last\_error;}
\DoxyCodeLine{88 \} \mbox{\hyperlink{structmp3dec__ex__t}{mp3dec\_ex\_t}};}
\DoxyCodeLine{89 }
\DoxyCodeLine{90 \textcolor{keyword}{typedef} int (*MP3D\_ITERATE\_CB)(\textcolor{keywordtype}{void} *user\_data, \textcolor{keyword}{const} uint8\_t *frame, \textcolor{keywordtype}{int} frame\_size, \textcolor{keywordtype}{int} free\_format\_bytes, \textcolor{keywordtype}{size\_t} buf\_size, uint64\_t offset, \mbox{\hyperlink{structmp3dec__frame__info__t}{mp3dec\_frame\_info\_t}} *info);}
\DoxyCodeLine{91 \textcolor{keyword}{typedef} int (*MP3D\_PROGRESS\_CB)(\textcolor{keywordtype}{void} *user\_data, \textcolor{keywordtype}{size\_t} file\_size, uint64\_t offset, \mbox{\hyperlink{structmp3dec__frame__info__t}{mp3dec\_frame\_info\_t}} *info);}
\DoxyCodeLine{92 }
\DoxyCodeLine{93 \textcolor{preprocessor}{\#ifdef \_\_cplusplus}}
\DoxyCodeLine{94 \textcolor{keyword}{extern} \textcolor{stringliteral}{"{}C"{}} \{}
\DoxyCodeLine{95 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{96 }
\DoxyCodeLine{97 \textcolor{comment}{/* detect mp3/mpa format */}}
\DoxyCodeLine{98 \textcolor{keywordtype}{int} mp3dec\_detect\_buf(\textcolor{keyword}{const} uint8\_t *buf, \textcolor{keywordtype}{size\_t} buf\_size);}
\DoxyCodeLine{99 \textcolor{keywordtype}{int} mp3dec\_detect\_cb(\mbox{\hyperlink{structmp3dec__io__t}{mp3dec\_io\_t}} *io, uint8\_t *buf, \textcolor{keywordtype}{size\_t} buf\_size);}
\DoxyCodeLine{100 \textcolor{comment}{/* decode whole buffer block */}}
\DoxyCodeLine{101 \textcolor{keywordtype}{int} mp3dec\_load\_buf(\mbox{\hyperlink{structmp3dec__t}{mp3dec\_t}} *dec, \textcolor{keyword}{const} uint8\_t *buf, \textcolor{keywordtype}{size\_t} buf\_size, \mbox{\hyperlink{structmp3dec__file__info__t}{mp3dec\_file\_info\_t}} *info, MP3D\_PROGRESS\_CB progress\_cb, \textcolor{keywordtype}{void} *user\_data);}
\DoxyCodeLine{102 \textcolor{keywordtype}{int} mp3dec\_load\_cb(\mbox{\hyperlink{structmp3dec__t}{mp3dec\_t}} *dec, \mbox{\hyperlink{structmp3dec__io__t}{mp3dec\_io\_t}} *io, uint8\_t *buf, \textcolor{keywordtype}{size\_t} buf\_size, \mbox{\hyperlink{structmp3dec__file__info__t}{mp3dec\_file\_info\_t}} *info, MP3D\_PROGRESS\_CB progress\_cb, \textcolor{keywordtype}{void} *user\_data);}
\DoxyCodeLine{103 \textcolor{comment}{/* iterate through frames */}}
\DoxyCodeLine{104 \textcolor{keywordtype}{int} mp3dec\_iterate\_buf(\textcolor{keyword}{const} uint8\_t *buf, \textcolor{keywordtype}{size\_t} buf\_size, MP3D\_ITERATE\_CB callback, \textcolor{keywordtype}{void} *user\_data);}
\DoxyCodeLine{105 \textcolor{keywordtype}{int} mp3dec\_iterate\_cb(\mbox{\hyperlink{structmp3dec__io__t}{mp3dec\_io\_t}} *io, uint8\_t *buf, \textcolor{keywordtype}{size\_t} buf\_size, MP3D\_ITERATE\_CB callback, \textcolor{keywordtype}{void} *user\_data);}
\DoxyCodeLine{106 \textcolor{comment}{/* streaming decoder with seeking capability */}}
\DoxyCodeLine{107 \textcolor{keywordtype}{int} mp3dec\_ex\_open\_buf(\mbox{\hyperlink{structmp3dec__ex__t}{mp3dec\_ex\_t}} *dec, \textcolor{keyword}{const} uint8\_t *buf, \textcolor{keywordtype}{size\_t} buf\_size, \textcolor{keywordtype}{int} flags);}
\DoxyCodeLine{108 \textcolor{keywordtype}{int} mp3dec\_ex\_open\_cb(\mbox{\hyperlink{structmp3dec__ex__t}{mp3dec\_ex\_t}} *dec, \mbox{\hyperlink{structmp3dec__io__t}{mp3dec\_io\_t}} *io, \textcolor{keywordtype}{int} flags);}
\DoxyCodeLine{109 \textcolor{keywordtype}{void} mp3dec\_ex\_close(\mbox{\hyperlink{structmp3dec__ex__t}{mp3dec\_ex\_t}} *dec);}
\DoxyCodeLine{110 \textcolor{keywordtype}{int} mp3dec\_ex\_seek(\mbox{\hyperlink{structmp3dec__ex__t}{mp3dec\_ex\_t}} *dec, uint64\_t position);}
\DoxyCodeLine{111 \textcolor{keywordtype}{size\_t} mp3dec\_ex\_read\_frame(\mbox{\hyperlink{structmp3dec__ex__t}{mp3dec\_ex\_t}} *dec, mp3d\_sample\_t **buf, \mbox{\hyperlink{structmp3dec__frame__info__t}{mp3dec\_frame\_info\_t}} *frame\_info, \textcolor{keywordtype}{size\_t} max\_samples);}
\DoxyCodeLine{112 \textcolor{keywordtype}{size\_t} mp3dec\_ex\_read(\mbox{\hyperlink{structmp3dec__ex__t}{mp3dec\_ex\_t}} *dec, mp3d\_sample\_t *buf, \textcolor{keywordtype}{size\_t} samples);}
\DoxyCodeLine{113 \textcolor{preprocessor}{\#ifndef MINIMP3\_NO\_STDIO}}
\DoxyCodeLine{114 \textcolor{comment}{/* stdio versions of file detect, load, iterate and stream */}}
\DoxyCodeLine{115 \textcolor{keywordtype}{int} mp3dec\_detect(\textcolor{keyword}{const} \textcolor{keywordtype}{char} *file\_name);}
\DoxyCodeLine{116 \textcolor{keywordtype}{int} mp3dec\_load(\mbox{\hyperlink{structmp3dec__t}{mp3dec\_t}} *dec, \textcolor{keyword}{const} \textcolor{keywordtype}{char} *file\_name, \mbox{\hyperlink{structmp3dec__file__info__t}{mp3dec\_file\_info\_t}} *info, MP3D\_PROGRESS\_CB progress\_cb, \textcolor{keywordtype}{void} *user\_data);}
\DoxyCodeLine{117 \textcolor{keywordtype}{int} mp3dec\_iterate(\textcolor{keyword}{const} \textcolor{keywordtype}{char} *file\_name, MP3D\_ITERATE\_CB callback, \textcolor{keywordtype}{void} *user\_data);}
\DoxyCodeLine{118 \textcolor{keywordtype}{int} mp3dec\_ex\_open(\mbox{\hyperlink{structmp3dec__ex__t}{mp3dec\_ex\_t}} *dec, \textcolor{keyword}{const} \textcolor{keywordtype}{char} *file\_name, \textcolor{keywordtype}{int} flags);}
\DoxyCodeLine{119 \textcolor{preprocessor}{\#ifdef \_WIN32}}
\DoxyCodeLine{120 \textcolor{keywordtype}{int} mp3dec\_detect\_w(\textcolor{keyword}{const} \textcolor{keywordtype}{wchar\_t} *file\_name);}
\DoxyCodeLine{121 \textcolor{keywordtype}{int} mp3dec\_load\_w(\mbox{\hyperlink{structmp3dec__t}{mp3dec\_t}} *dec, \textcolor{keyword}{const} \textcolor{keywordtype}{wchar\_t} *file\_name, \mbox{\hyperlink{structmp3dec__file__info__t}{mp3dec\_file\_info\_t}} *info, MP3D\_PROGRESS\_CB progress\_cb, \textcolor{keywordtype}{void} *user\_data);}
\DoxyCodeLine{122 \textcolor{keywordtype}{int} mp3dec\_iterate\_w(\textcolor{keyword}{const} \textcolor{keywordtype}{wchar\_t} *file\_name, MP3D\_ITERATE\_CB callback, \textcolor{keywordtype}{void} *user\_data);}
\DoxyCodeLine{123 \textcolor{keywordtype}{int} mp3dec\_ex\_open\_w(\mbox{\hyperlink{structmp3dec__ex__t}{mp3dec\_ex\_t}} *dec, \textcolor{keyword}{const} \textcolor{keywordtype}{wchar\_t} *file\_name, \textcolor{keywordtype}{int} flags);}
\DoxyCodeLine{124 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{125 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{126 }
\DoxyCodeLine{127 \textcolor{preprocessor}{\#ifdef \_\_cplusplus}}
\DoxyCodeLine{128 \}}
\DoxyCodeLine{129 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{130 \textcolor{preprocessor}{\#endif }\textcolor{comment}{/*MINIMP3\_EXT\_H*/}\textcolor{preprocessor}{}}
\DoxyCodeLine{131 }
\DoxyCodeLine{132 \textcolor{preprocessor}{\#if defined(MINIMP3\_IMPLEMENTATION) \&\& !defined(\_MINIMP3\_EX\_IMPLEMENTATION\_GUARD)}}
\DoxyCodeLine{133 \textcolor{preprocessor}{\#define \_MINIMP3\_EX\_IMPLEMENTATION\_GUARD}}
\DoxyCodeLine{134 \textcolor{preprocessor}{\#include <limits.h>}}
\DoxyCodeLine{135 \textcolor{preprocessor}{\#include "{}minimp3.h"{}}}
\DoxyCodeLine{136 }
\DoxyCodeLine{137 \textcolor{keyword}{static} \textcolor{keywordtype}{void} mp3dec\_skip\_id3v1(\textcolor{keyword}{const} uint8\_t *buf, \textcolor{keywordtype}{size\_t} *pbuf\_size)}
\DoxyCodeLine{138 \{}
\DoxyCodeLine{139     \textcolor{keywordtype}{size\_t} buf\_size = *pbuf\_size;}
\DoxyCodeLine{140 \textcolor{preprocessor}{\#ifndef MINIMP3\_NOSKIP\_ID3V1}}
\DoxyCodeLine{141     \textcolor{keywordflow}{if} (buf\_size >= 128 \&\& !memcmp(buf + buf\_size -\/ 128, \textcolor{stringliteral}{"{}TAG"{}}, 3))}
\DoxyCodeLine{142     \{}
\DoxyCodeLine{143         buf\_size -\/= 128;}
\DoxyCodeLine{144         \textcolor{keywordflow}{if} (buf\_size >= 227 \&\& !memcmp(buf + buf\_size -\/ 227, \textcolor{stringliteral}{"{}TAG+"{}}, 4))}
\DoxyCodeLine{145             buf\_size -\/= 227;}
\DoxyCodeLine{146     \}}
\DoxyCodeLine{147 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{148 \textcolor{preprocessor}{\#ifndef MINIMP3\_NOSKIP\_APEV2}}
\DoxyCodeLine{149     \textcolor{keywordflow}{if} (buf\_size > 32 \&\& !memcmp(buf + buf\_size -\/ 32, \textcolor{stringliteral}{"{}APETAGEX"{}}, 8))}
\DoxyCodeLine{150     \{}
\DoxyCodeLine{151         buf\_size -\/= 32;}
\DoxyCodeLine{152         \textcolor{keyword}{const} uint8\_t *tag = buf + buf\_size + 8 + 4;}
\DoxyCodeLine{153         uint32\_t tag\_size = (uint32\_t)(tag[3] << 24) | (tag[2] << 16) | (tag[1] << 8) | tag[0];}
\DoxyCodeLine{154         \textcolor{keywordflow}{if} (buf\_size >= tag\_size)}
\DoxyCodeLine{155             buf\_size -\/= tag\_size;}
\DoxyCodeLine{156     \}}
\DoxyCodeLine{157 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{158     *pbuf\_size = buf\_size;}
\DoxyCodeLine{159 \}}
\DoxyCodeLine{160 }
\DoxyCodeLine{161 \textcolor{keyword}{static} \textcolor{keywordtype}{size\_t} mp3dec\_skip\_id3v2(\textcolor{keyword}{const} uint8\_t *buf, \textcolor{keywordtype}{size\_t} buf\_size)}
\DoxyCodeLine{162 \{}
\DoxyCodeLine{163 \textcolor{preprocessor}{\#define MINIMP3\_ID3\_DETECT\_SIZE 10}}
\DoxyCodeLine{164 \textcolor{preprocessor}{\#ifndef MINIMP3\_NOSKIP\_ID3V2}}
\DoxyCodeLine{165     \textcolor{keywordflow}{if} (buf\_size >= MINIMP3\_ID3\_DETECT\_SIZE \&\& !memcmp(buf, \textcolor{stringliteral}{"{}ID3"{}}, 3) \&\& !((buf[5] \& 15) || (buf[6] \& 0x80) || (buf[7] \& 0x80) || (buf[8] \& 0x80) || (buf[9] \& 0x80)))}
\DoxyCodeLine{166     \{}
\DoxyCodeLine{167         \textcolor{keywordtype}{size\_t} id3v2size = (((buf[6] \& 0x7f) << 21) | ((buf[7] \& 0x7f) << 14) | ((buf[8] \& 0x7f) << 7) | (buf[9] \& 0x7f)) + 10;}
\DoxyCodeLine{168         \textcolor{keywordflow}{if} ((buf[5] \& 16))}
\DoxyCodeLine{169             id3v2size += 10; \textcolor{comment}{/* footer */}}
\DoxyCodeLine{170         \textcolor{keywordflow}{return} id3v2size;}
\DoxyCodeLine{171     \}}
\DoxyCodeLine{172 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{173     \textcolor{keywordflow}{return} 0;}
\DoxyCodeLine{174 \}}
\DoxyCodeLine{175 }
\DoxyCodeLine{176 \textcolor{keyword}{static} \textcolor{keywordtype}{void} mp3dec\_skip\_id3(\textcolor{keyword}{const} uint8\_t **pbuf, \textcolor{keywordtype}{size\_t} *pbuf\_size)}
\DoxyCodeLine{177 \{}
\DoxyCodeLine{178     uint8\_t *buf = (uint8\_t *)(*pbuf);}
\DoxyCodeLine{179     \textcolor{keywordtype}{size\_t} buf\_size = *pbuf\_size;}
\DoxyCodeLine{180     \textcolor{keywordtype}{size\_t} id3v2size = mp3dec\_skip\_id3v2(buf, buf\_size);}
\DoxyCodeLine{181     \textcolor{keywordflow}{if} (id3v2size)}
\DoxyCodeLine{182     \{}
\DoxyCodeLine{183         \textcolor{keywordflow}{if} (id3v2size >= buf\_size)}
\DoxyCodeLine{184             id3v2size = buf\_size;}
\DoxyCodeLine{185         buf      += id3v2size;}
\DoxyCodeLine{186         buf\_size -\/= id3v2size;}
\DoxyCodeLine{187     \}}
\DoxyCodeLine{188     mp3dec\_skip\_id3v1(buf, \&buf\_size);}
\DoxyCodeLine{189     *pbuf = (\textcolor{keyword}{const} uint8\_t *)buf;}
\DoxyCodeLine{190     *pbuf\_size = buf\_size;}
\DoxyCodeLine{191 \}}
\DoxyCodeLine{192 }
\DoxyCodeLine{193 \textcolor{keyword}{static} \textcolor{keywordtype}{int} mp3dec\_check\_vbrtag(\textcolor{keyword}{const} uint8\_t *frame, \textcolor{keywordtype}{int} frame\_size, uint32\_t *frames, \textcolor{keywordtype}{int} *delay, \textcolor{keywordtype}{int} *padding)}
\DoxyCodeLine{194 \{}
\DoxyCodeLine{195     \textcolor{keyword}{static} \textcolor{keyword}{const} \textcolor{keywordtype}{char} g\_xing\_tag[4] = \{ \textcolor{charliteral}{'X'}, \textcolor{charliteral}{'i'}, \textcolor{charliteral}{'n'}, \textcolor{charliteral}{'g'} \};}
\DoxyCodeLine{196     \textcolor{keyword}{static} \textcolor{keyword}{const} \textcolor{keywordtype}{char} g\_info\_tag[4] = \{ \textcolor{charliteral}{'I'}, \textcolor{charliteral}{'n'}, \textcolor{charliteral}{'f'}, \textcolor{charliteral}{'o'} \};}
\DoxyCodeLine{197 \textcolor{preprocessor}{\#define FRAMES\_FLAG     1}}
\DoxyCodeLine{198 \textcolor{preprocessor}{\#define BYTES\_FLAG      2}}
\DoxyCodeLine{199 \textcolor{preprocessor}{\#define TOC\_FLAG        4}}
\DoxyCodeLine{200 \textcolor{preprocessor}{\#define VBR\_SCALE\_FLAG  8}}
\DoxyCodeLine{201     \textcolor{comment}{/* Side info offsets after header:}}
\DoxyCodeLine{202 \textcolor{comment}{    /                Mono  Stereo}}
\DoxyCodeLine{203 \textcolor{comment}{    /  MPEG1          17     32}}
\DoxyCodeLine{204 \textcolor{comment}{    /  MPEG2 \& 2.5     9     17*/}}
\DoxyCodeLine{205     bs\_t bs[1];}
\DoxyCodeLine{206     L3\_gr\_info\_t gr\_info[4];}
\DoxyCodeLine{207     bs\_init(bs, frame + HDR\_SIZE, frame\_size -\/ HDR\_SIZE);}
\DoxyCodeLine{208     \textcolor{keywordflow}{if} (HDR\_IS\_CRC(frame))}
\DoxyCodeLine{209         get\_bits(bs, 16);}
\DoxyCodeLine{210     \textcolor{keywordflow}{if} (L3\_read\_side\_info(bs, gr\_info, frame) < 0)}
\DoxyCodeLine{211         \textcolor{keywordflow}{return} 0; \textcolor{comment}{/* side info corrupted */}}
\DoxyCodeLine{212 }
\DoxyCodeLine{213     \textcolor{keyword}{const} uint8\_t *tag = frame + HDR\_SIZE + bs-\/>pos/8;}
\DoxyCodeLine{214     \textcolor{keywordflow}{if} (memcmp(g\_xing\_tag, tag, 4) \&\& memcmp(g\_info\_tag, tag, 4))}
\DoxyCodeLine{215         \textcolor{keywordflow}{return} 0;}
\DoxyCodeLine{216     \textcolor{keywordtype}{int} flags = tag[7];}
\DoxyCodeLine{217     \textcolor{keywordflow}{if} (!((flags \& FRAMES\_FLAG)))}
\DoxyCodeLine{218         \textcolor{keywordflow}{return} -\/1;}
\DoxyCodeLine{219     tag += 8;}
\DoxyCodeLine{220     *frames = (uint32\_t)(tag[0] << 24) | (tag[1] << 16) | (tag[2] << 8) | tag[3];}
\DoxyCodeLine{221     tag += 4;}
\DoxyCodeLine{222     \textcolor{keywordflow}{if} (flags \& BYTES\_FLAG)}
\DoxyCodeLine{223         tag += 4;}
\DoxyCodeLine{224     \textcolor{keywordflow}{if} (flags \& TOC\_FLAG)}
\DoxyCodeLine{225         tag += 100;}
\DoxyCodeLine{226     \textcolor{keywordflow}{if} (flags \& VBR\_SCALE\_FLAG)}
\DoxyCodeLine{227         tag += 4;}
\DoxyCodeLine{228     *delay = *padding = 0;}
\DoxyCodeLine{229     \textcolor{keywordflow}{if} (*tag)}
\DoxyCodeLine{230     \{   \textcolor{comment}{/* extension, LAME, Lavc, etc. Should be the same structure. */}}
\DoxyCodeLine{231         tag += 21;}
\DoxyCodeLine{232         \textcolor{keywordflow}{if} (tag -\/ frame + 14 >= frame\_size)}
\DoxyCodeLine{233             \textcolor{keywordflow}{return} 0;}
\DoxyCodeLine{234         *delay   = ((tag[0] << 4) | (tag[1] >> 4)) + (528 + 1);}
\DoxyCodeLine{235         *padding = (((tag[1] \& 0xF) << 8) | tag[2]) -\/ (528 + 1);}
\DoxyCodeLine{236     \}}
\DoxyCodeLine{237     \textcolor{keywordflow}{return} 1;}
\DoxyCodeLine{238 \}}
\DoxyCodeLine{239 }
\DoxyCodeLine{240 \textcolor{keywordtype}{int} mp3dec\_detect\_buf(\textcolor{keyword}{const} uint8\_t *buf, \textcolor{keywordtype}{size\_t} buf\_size)}
\DoxyCodeLine{241 \{}
\DoxyCodeLine{242     \textcolor{keywordflow}{return} mp3dec\_detect\_cb(0, (uint8\_t *)buf, buf\_size);}
\DoxyCodeLine{243 \}}
\DoxyCodeLine{244 }
\DoxyCodeLine{245 \textcolor{keywordtype}{int} mp3dec\_detect\_cb(\mbox{\hyperlink{structmp3dec__io__t}{mp3dec\_io\_t}} *io, uint8\_t *buf, \textcolor{keywordtype}{size\_t} buf\_size)}
\DoxyCodeLine{246 \{}
\DoxyCodeLine{247     \textcolor{keywordflow}{if} (!buf || (\textcolor{keywordtype}{size\_t})-\/1 == buf\_size || (io \&\& buf\_size < MINIMP3\_BUF\_SIZE))}
\DoxyCodeLine{248         \textcolor{keywordflow}{return} MP3D\_E\_PARAM;}
\DoxyCodeLine{249     \textcolor{keywordtype}{size\_t} filled = buf\_size;}
\DoxyCodeLine{250     \textcolor{keywordflow}{if} (io)}
\DoxyCodeLine{251     \{}
\DoxyCodeLine{252         \textcolor{keywordflow}{if} (io-\/>seek(0, io-\/>seek\_data))}
\DoxyCodeLine{253             \textcolor{keywordflow}{return} MP3D\_E\_IOERROR;}
\DoxyCodeLine{254         filled = io-\/>read(buf, MINIMP3\_ID3\_DETECT\_SIZE, io-\/>read\_data);}
\DoxyCodeLine{255         \textcolor{keywordflow}{if} (filled > MINIMP3\_ID3\_DETECT\_SIZE)}
\DoxyCodeLine{256             \textcolor{keywordflow}{return} MP3D\_E\_IOERROR;}
\DoxyCodeLine{257     \}}
\DoxyCodeLine{258     \textcolor{keywordflow}{if} (filled < MINIMP3\_ID3\_DETECT\_SIZE)}
\DoxyCodeLine{259         \textcolor{keywordflow}{return} MP3D\_E\_USER; \textcolor{comment}{/* too small, can't be mp3/mpa */}}
\DoxyCodeLine{260     \textcolor{keywordflow}{if} (mp3dec\_skip\_id3v2(buf, filled))}
\DoxyCodeLine{261         \textcolor{keywordflow}{return} 0; \textcolor{comment}{/* id3v2 tag is enough evidence */}}
\DoxyCodeLine{262     \textcolor{keywordflow}{if} (io)}
\DoxyCodeLine{263     \{}
\DoxyCodeLine{264         \textcolor{keywordtype}{size\_t} readed = io-\/>read(buf + MINIMP3\_ID3\_DETECT\_SIZE, buf\_size -\/ MINIMP3\_ID3\_DETECT\_SIZE, io-\/>read\_data);}
\DoxyCodeLine{265         \textcolor{keywordflow}{if} (readed > (buf\_size -\/ MINIMP3\_ID3\_DETECT\_SIZE))}
\DoxyCodeLine{266             \textcolor{keywordflow}{return} MP3D\_E\_IOERROR;}
\DoxyCodeLine{267         filled += readed;}
\DoxyCodeLine{268         \textcolor{keywordflow}{if} (filled < MINIMP3\_BUF\_SIZE)}
\DoxyCodeLine{269             mp3dec\_skip\_id3v1(buf, \&filled);}
\DoxyCodeLine{270     \} \textcolor{keywordflow}{else}}
\DoxyCodeLine{271     \{}
\DoxyCodeLine{272         mp3dec\_skip\_id3v1(buf, \&filled);}
\DoxyCodeLine{273         \textcolor{keywordflow}{if} (filled > MINIMP3\_BUF\_SIZE)}
\DoxyCodeLine{274             filled = MINIMP3\_BUF\_SIZE;}
\DoxyCodeLine{275     \}}
\DoxyCodeLine{276     \textcolor{keywordtype}{int} free\_format\_bytes, frame\_size;}
\DoxyCodeLine{277     mp3d\_find\_frame(buf, filled, \&free\_format\_bytes, \&frame\_size);}
\DoxyCodeLine{278     \textcolor{keywordflow}{if} (frame\_size)}
\DoxyCodeLine{279         \textcolor{keywordflow}{return} 0; \textcolor{comment}{/* MAX\_FRAME\_SYNC\_MATCHES consecutive frames found */}}
\DoxyCodeLine{280     \textcolor{keywordflow}{return} MP3D\_E\_USER;}
\DoxyCodeLine{281 \}}
\DoxyCodeLine{282 }
\DoxyCodeLine{283 \textcolor{keywordtype}{int} mp3dec\_load\_buf(\mbox{\hyperlink{structmp3dec__t}{mp3dec\_t}} *dec, \textcolor{keyword}{const} uint8\_t *buf, \textcolor{keywordtype}{size\_t} buf\_size, \mbox{\hyperlink{structmp3dec__file__info__t}{mp3dec\_file\_info\_t}} *info, MP3D\_PROGRESS\_CB progress\_cb, \textcolor{keywordtype}{void} *user\_data)}
\DoxyCodeLine{284 \{}
\DoxyCodeLine{285     \textcolor{keywordflow}{return} mp3dec\_load\_cb(dec, 0, (uint8\_t *)buf, buf\_size, info, progress\_cb, user\_data);}
\DoxyCodeLine{286 \}}
\DoxyCodeLine{287 }
\DoxyCodeLine{288 \textcolor{keywordtype}{int} mp3dec\_load\_cb(\mbox{\hyperlink{structmp3dec__t}{mp3dec\_t}} *dec, \mbox{\hyperlink{structmp3dec__io__t}{mp3dec\_io\_t}} *io, uint8\_t *buf, \textcolor{keywordtype}{size\_t} buf\_size, \mbox{\hyperlink{structmp3dec__file__info__t}{mp3dec\_file\_info\_t}} *info, MP3D\_PROGRESS\_CB progress\_cb, \textcolor{keywordtype}{void} *user\_data)}
\DoxyCodeLine{289 \{}
\DoxyCodeLine{290     \textcolor{keywordflow}{if} (!dec || !buf || !info || (\textcolor{keywordtype}{size\_t})-\/1 == buf\_size || (io \&\& buf\_size < MINIMP3\_BUF\_SIZE))}
\DoxyCodeLine{291         \textcolor{keywordflow}{return} MP3D\_E\_PARAM;}
\DoxyCodeLine{292     uint64\_t detected\_samples = 0;}
\DoxyCodeLine{293     \textcolor{keywordtype}{size\_t} orig\_buf\_size = buf\_size;}
\DoxyCodeLine{294     \textcolor{keywordtype}{int} to\_skip = 0;}
\DoxyCodeLine{295     \mbox{\hyperlink{structmp3dec__frame__info__t}{mp3dec\_frame\_info\_t}} frame\_info;}
\DoxyCodeLine{296     memset(info, 0, \textcolor{keyword}{sizeof}(*info));}
\DoxyCodeLine{297     memset(\&frame\_info, 0, \textcolor{keyword}{sizeof}(frame\_info));}
\DoxyCodeLine{298 }
\DoxyCodeLine{299     \textcolor{comment}{/* skip id3 */}}
\DoxyCodeLine{300     \textcolor{keywordtype}{size\_t} filled = 0, consumed = 0;}
\DoxyCodeLine{301     \textcolor{keywordtype}{int} eof = 0, ret = 0;}
\DoxyCodeLine{302     \textcolor{keywordflow}{if} (io)}
\DoxyCodeLine{303     \{}
\DoxyCodeLine{304         \textcolor{keywordflow}{if} (io-\/>seek(0, io-\/>seek\_data))}
\DoxyCodeLine{305             \textcolor{keywordflow}{return} MP3D\_E\_IOERROR;}
\DoxyCodeLine{306         filled = io-\/>read(buf, MINIMP3\_ID3\_DETECT\_SIZE, io-\/>read\_data);}
\DoxyCodeLine{307         \textcolor{keywordflow}{if} (filled > MINIMP3\_ID3\_DETECT\_SIZE)}
\DoxyCodeLine{308             \textcolor{keywordflow}{return} MP3D\_E\_IOERROR;}
\DoxyCodeLine{309         \textcolor{keywordflow}{if} (MINIMP3\_ID3\_DETECT\_SIZE != filled)}
\DoxyCodeLine{310             \textcolor{keywordflow}{return} 0;}
\DoxyCodeLine{311         \textcolor{keywordtype}{size\_t} id3v2size = mp3dec\_skip\_id3v2(buf, filled);}
\DoxyCodeLine{312         \textcolor{keywordflow}{if} (id3v2size)}
\DoxyCodeLine{313         \{}
\DoxyCodeLine{314             \textcolor{keywordflow}{if} (io-\/>seek(id3v2size, io-\/>seek\_data))}
\DoxyCodeLine{315                 \textcolor{keywordflow}{return} MP3D\_E\_IOERROR;}
\DoxyCodeLine{316             filled = io-\/>read(buf, buf\_size, io-\/>read\_data);}
\DoxyCodeLine{317             \textcolor{keywordflow}{if} (filled > buf\_size)}
\DoxyCodeLine{318                 \textcolor{keywordflow}{return} MP3D\_E\_IOERROR;}
\DoxyCodeLine{319         \} \textcolor{keywordflow}{else}}
\DoxyCodeLine{320         \{}
\DoxyCodeLine{321             \textcolor{keywordtype}{size\_t} readed = io-\/>read(buf + MINIMP3\_ID3\_DETECT\_SIZE, buf\_size -\/ MINIMP3\_ID3\_DETECT\_SIZE, io-\/>read\_data);}
\DoxyCodeLine{322             \textcolor{keywordflow}{if} (readed > (buf\_size -\/ MINIMP3\_ID3\_DETECT\_SIZE))}
\DoxyCodeLine{323                 \textcolor{keywordflow}{return} MP3D\_E\_IOERROR;}
\DoxyCodeLine{324             filled += readed;}
\DoxyCodeLine{325         \}}
\DoxyCodeLine{326         \textcolor{keywordflow}{if} (filled < MINIMP3\_BUF\_SIZE)}
\DoxyCodeLine{327             mp3dec\_skip\_id3v1(buf, \&filled);}
\DoxyCodeLine{328     \} \textcolor{keywordflow}{else}}
\DoxyCodeLine{329     \{}
\DoxyCodeLine{330         mp3dec\_skip\_id3((\textcolor{keyword}{const} uint8\_t **)\&buf, \&buf\_size);}
\DoxyCodeLine{331         \textcolor{keywordflow}{if} (!buf\_size)}
\DoxyCodeLine{332             \textcolor{keywordflow}{return} 0;}
\DoxyCodeLine{333     \}}
\DoxyCodeLine{334     \textcolor{comment}{/* try to make allocation size assumption by first frame or vbr tag */}}
\DoxyCodeLine{335     mp3dec\_init(dec);}
\DoxyCodeLine{336     \textcolor{keywordtype}{int} samples;}
\DoxyCodeLine{337     \textcolor{keywordflow}{do}}
\DoxyCodeLine{338     \{}
\DoxyCodeLine{339         uint32\_t frames;}
\DoxyCodeLine{340         \textcolor{keywordtype}{int} i, delay, padding, free\_format\_bytes = 0, frame\_size = 0;}
\DoxyCodeLine{341         \textcolor{keyword}{const} uint8\_t *hdr;}
\DoxyCodeLine{342         \textcolor{keywordflow}{if} (io)}
\DoxyCodeLine{343         \{}
\DoxyCodeLine{344             \textcolor{keywordflow}{if} (!eof \&\& filled -\/ consumed < MINIMP3\_BUF\_SIZE)}
\DoxyCodeLine{345             \{   \textcolor{comment}{/* keep minimum 10 consecutive mp3 frames (\string~16KB) worst case */}}
\DoxyCodeLine{346                 memmove(buf, buf + consumed, filled -\/ consumed);}
\DoxyCodeLine{347                 filled -\/= consumed;}
\DoxyCodeLine{348                 consumed = 0;}
\DoxyCodeLine{349                 \textcolor{keywordtype}{size\_t} readed = io-\/>read(buf + filled, buf\_size -\/ filled, io-\/>read\_data);}
\DoxyCodeLine{350                 \textcolor{keywordflow}{if} (readed > (buf\_size -\/ filled))}
\DoxyCodeLine{351                     \textcolor{keywordflow}{return} MP3D\_E\_IOERROR;}
\DoxyCodeLine{352                 \textcolor{keywordflow}{if} (readed != (buf\_size -\/ filled))}
\DoxyCodeLine{353                     eof = 1;}
\DoxyCodeLine{354                 filled += readed;}
\DoxyCodeLine{355                 \textcolor{keywordflow}{if} (eof)}
\DoxyCodeLine{356                     mp3dec\_skip\_id3v1(buf, \&filled);}
\DoxyCodeLine{357             \}}
\DoxyCodeLine{358             i = mp3d\_find\_frame(buf + consumed, filled -\/ consumed, \&free\_format\_bytes, \&frame\_size);}
\DoxyCodeLine{359             consumed += i;}
\DoxyCodeLine{360             hdr = buf + consumed;}
\DoxyCodeLine{361         \} \textcolor{keywordflow}{else}}
\DoxyCodeLine{362         \{}
\DoxyCodeLine{363             i = mp3d\_find\_frame(buf, buf\_size, \&free\_format\_bytes, \&frame\_size);}
\DoxyCodeLine{364             buf      += i;}
\DoxyCodeLine{365             buf\_size -\/= i;}
\DoxyCodeLine{366             hdr = buf;}
\DoxyCodeLine{367         \}}
\DoxyCodeLine{368         \textcolor{keywordflow}{if} (i \&\& !frame\_size)}
\DoxyCodeLine{369             \textcolor{keywordflow}{continue};}
\DoxyCodeLine{370         \textcolor{keywordflow}{if} (!frame\_size)}
\DoxyCodeLine{371             \textcolor{keywordflow}{return} 0;}
\DoxyCodeLine{372         frame\_info.channels = HDR\_IS\_MONO(hdr) ? 1 : 2;}
\DoxyCodeLine{373         frame\_info.hz = hdr\_sample\_rate\_hz(hdr);}
\DoxyCodeLine{374         frame\_info.layer = 4 -\/ HDR\_GET\_LAYER(hdr);}
\DoxyCodeLine{375         frame\_info.bitrate\_kbps = hdr\_bitrate\_kbps(hdr);}
\DoxyCodeLine{376         frame\_info.frame\_bytes = frame\_size;}
\DoxyCodeLine{377         samples = hdr\_frame\_samples(hdr)*frame\_info.channels;}
\DoxyCodeLine{378         \textcolor{keywordflow}{if} (3 != frame\_info.layer)}
\DoxyCodeLine{379             \textcolor{keywordflow}{break};}
\DoxyCodeLine{380         \textcolor{keywordtype}{int} ret = mp3dec\_check\_vbrtag(hdr, frame\_size, \&frames, \&delay, \&padding);}
\DoxyCodeLine{381         \textcolor{keywordflow}{if} (ret > 0)}
\DoxyCodeLine{382         \{}
\DoxyCodeLine{383             padding *= frame\_info.channels;}
\DoxyCodeLine{384             to\_skip = delay*frame\_info.channels;}
\DoxyCodeLine{385             detected\_samples = samples*(uint64\_t)frames;}
\DoxyCodeLine{386             \textcolor{keywordflow}{if} (detected\_samples >= (uint64\_t)to\_skip)}
\DoxyCodeLine{387                 detected\_samples -\/= to\_skip;}
\DoxyCodeLine{388             \textcolor{keywordflow}{if} (padding > 0 \&\& detected\_samples >= (uint64\_t)padding)}
\DoxyCodeLine{389                 detected\_samples -\/= padding;}
\DoxyCodeLine{390             \textcolor{keywordflow}{if} (!detected\_samples)}
\DoxyCodeLine{391                 \textcolor{keywordflow}{return} 0;}
\DoxyCodeLine{392         \}}
\DoxyCodeLine{393         \textcolor{keywordflow}{if} (ret)}
\DoxyCodeLine{394         \{}
\DoxyCodeLine{395             \textcolor{keywordflow}{if} (io)}
\DoxyCodeLine{396             \{}
\DoxyCodeLine{397                 consumed += frame\_size;}
\DoxyCodeLine{398             \} \textcolor{keywordflow}{else}}
\DoxyCodeLine{399             \{}
\DoxyCodeLine{400                 buf      += frame\_size;}
\DoxyCodeLine{401                 buf\_size -\/= frame\_size;}
\DoxyCodeLine{402             \}}
\DoxyCodeLine{403         \}}
\DoxyCodeLine{404         \textcolor{keywordflow}{break};}
\DoxyCodeLine{405     \} \textcolor{keywordflow}{while}(1);}
\DoxyCodeLine{406     \textcolor{keywordtype}{size\_t} allocated = MINIMP3\_MAX\_SAMPLES\_PER\_FRAME*\textcolor{keyword}{sizeof}(mp3d\_sample\_t);}
\DoxyCodeLine{407     \textcolor{keywordflow}{if} (detected\_samples)}
\DoxyCodeLine{408         allocated += detected\_samples*\textcolor{keyword}{sizeof}(mp3d\_sample\_t);}
\DoxyCodeLine{409     \textcolor{keywordflow}{else}}
\DoxyCodeLine{410         allocated += (buf\_size/frame\_info.frame\_bytes)*samples*\textcolor{keyword}{sizeof}(mp3d\_sample\_t);}
\DoxyCodeLine{411     info-\/>buffer = (mp3d\_sample\_t*)malloc(allocated);}
\DoxyCodeLine{412     \textcolor{keywordflow}{if} (!info-\/>buffer)}
\DoxyCodeLine{413         \textcolor{keywordflow}{return} MP3D\_E\_MEMORY;}
\DoxyCodeLine{414     \textcolor{comment}{/* save info */}}
\DoxyCodeLine{415     info-\/>channels = frame\_info.channels;}
\DoxyCodeLine{416     info-\/>hz       = frame\_info.hz;}
\DoxyCodeLine{417     info-\/>layer    = frame\_info.layer;}
\DoxyCodeLine{418     \textcolor{comment}{/* decode all frames */}}
\DoxyCodeLine{419     \textcolor{keywordtype}{size\_t} avg\_bitrate\_kbps = 0, frames = 0;}
\DoxyCodeLine{420     \textcolor{keywordflow}{do}}
\DoxyCodeLine{421     \{}
\DoxyCodeLine{422         \textcolor{keywordflow}{if} ((allocated -\/ info-\/>samples*\textcolor{keyword}{sizeof}(mp3d\_sample\_t)) < MINIMP3\_MAX\_SAMPLES\_PER\_FRAME*\textcolor{keyword}{sizeof}(mp3d\_sample\_t))}
\DoxyCodeLine{423         \{}
\DoxyCodeLine{424             allocated *= 2;}
\DoxyCodeLine{425             mp3d\_sample\_t *alloc\_buf = (mp3d\_sample\_t*)realloc(info-\/>buffer, allocated);}
\DoxyCodeLine{426             \textcolor{keywordflow}{if} (!alloc\_buf)}
\DoxyCodeLine{427                 \textcolor{keywordflow}{return} MP3D\_E\_MEMORY;}
\DoxyCodeLine{428             info-\/>buffer = alloc\_buf;}
\DoxyCodeLine{429         \}}
\DoxyCodeLine{430         \textcolor{keywordflow}{if} (io)}
\DoxyCodeLine{431         \{}
\DoxyCodeLine{432             \textcolor{keywordflow}{if} (!eof \&\& filled -\/ consumed < MINIMP3\_BUF\_SIZE)}
\DoxyCodeLine{433             \{   \textcolor{comment}{/* keep minimum 10 consecutive mp3 frames (\string~16KB) worst case */}}
\DoxyCodeLine{434                 memmove(buf, buf + consumed, filled -\/ consumed);}
\DoxyCodeLine{435                 filled -\/= consumed;}
\DoxyCodeLine{436                 consumed = 0;}
\DoxyCodeLine{437                 \textcolor{keywordtype}{size\_t} readed = io-\/>read(buf + filled, buf\_size -\/ filled, io-\/>read\_data);}
\DoxyCodeLine{438                 \textcolor{keywordflow}{if} (readed != (buf\_size -\/ filled))}
\DoxyCodeLine{439                     eof = 1;}
\DoxyCodeLine{440                 filled += readed;}
\DoxyCodeLine{441                 \textcolor{keywordflow}{if} (eof)}
\DoxyCodeLine{442                     mp3dec\_skip\_id3v1(buf, \&filled);}
\DoxyCodeLine{443             \}}
\DoxyCodeLine{444             samples = mp3dec\_decode\_frame(dec, buf + consumed, filled -\/ consumed, info-\/>buffer + info-\/>samples, \&frame\_info);}
\DoxyCodeLine{445             consumed += frame\_info.frame\_bytes;}
\DoxyCodeLine{446         \} \textcolor{keywordflow}{else}}
\DoxyCodeLine{447         \{}
\DoxyCodeLine{448             samples = mp3dec\_decode\_frame(dec, buf, MINIMP3\_MIN(buf\_size, (\textcolor{keywordtype}{size\_t})INT\_MAX), info-\/>buffer + info-\/>samples, \&frame\_info);}
\DoxyCodeLine{449             buf      += frame\_info.frame\_bytes;}
\DoxyCodeLine{450             buf\_size -\/= frame\_info.frame\_bytes;}
\DoxyCodeLine{451         \}}
\DoxyCodeLine{452         \textcolor{keywordflow}{if} (samples)}
\DoxyCodeLine{453         \{}
\DoxyCodeLine{454             \textcolor{keywordflow}{if} (info-\/>hz != frame\_info.hz || info-\/>layer != frame\_info.layer)}
\DoxyCodeLine{455             \{}
\DoxyCodeLine{456                 ret = MP3D\_E\_DECODE;}
\DoxyCodeLine{457                 \textcolor{keywordflow}{break};}
\DoxyCodeLine{458             \}}
\DoxyCodeLine{459             \textcolor{keywordflow}{if} (info-\/>channels \&\& info-\/>channels != frame\_info.channels)}
\DoxyCodeLine{460             \{}
\DoxyCodeLine{461 \textcolor{preprocessor}{\#ifdef MINIMP3\_ALLOW\_MONO\_STEREO\_TRANSITION}}
\DoxyCodeLine{462                 info-\/>channels = 0; \textcolor{comment}{/* mark file with mono-\/stereo transition */}}
\DoxyCodeLine{463 \textcolor{preprocessor}{\#else}}
\DoxyCodeLine{464                 ret = MP3D\_E\_DECODE;}
\DoxyCodeLine{465                 \textcolor{keywordflow}{break};}
\DoxyCodeLine{466 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{467             \}}
\DoxyCodeLine{468             samples *= frame\_info.channels;}
\DoxyCodeLine{469             \textcolor{keywordflow}{if} (to\_skip)}
\DoxyCodeLine{470             \{}
\DoxyCodeLine{471                 \textcolor{keywordtype}{size\_t} skip = MINIMP3\_MIN(samples, to\_skip);}
\DoxyCodeLine{472                 to\_skip -\/= skip;}
\DoxyCodeLine{473                 samples -\/= skip;}
\DoxyCodeLine{474                 memmove(info-\/>buffer, info-\/>buffer + skip, samples*\textcolor{keyword}{sizeof}(mp3d\_sample\_t));}
\DoxyCodeLine{475             \}}
\DoxyCodeLine{476             info-\/>samples += samples;}
\DoxyCodeLine{477             avg\_bitrate\_kbps += frame\_info.bitrate\_kbps;}
\DoxyCodeLine{478             frames++;}
\DoxyCodeLine{479             \textcolor{keywordflow}{if} (progress\_cb)}
\DoxyCodeLine{480             \{}
\DoxyCodeLine{481                 ret = progress\_cb(user\_data, orig\_buf\_size, orig\_buf\_size -\/ buf\_size, \&frame\_info);}
\DoxyCodeLine{482                 \textcolor{keywordflow}{if} (ret)}
\DoxyCodeLine{483                     \textcolor{keywordflow}{break};}
\DoxyCodeLine{484             \}}
\DoxyCodeLine{485         \}}
\DoxyCodeLine{486     \} \textcolor{keywordflow}{while} (frame\_info.frame\_bytes);}
\DoxyCodeLine{487     \textcolor{keywordflow}{if} (detected\_samples \&\& info-\/>samples > detected\_samples)}
\DoxyCodeLine{488         info-\/>samples = detected\_samples; \textcolor{comment}{/* cut padding */}}
\DoxyCodeLine{489     \textcolor{comment}{/* reallocate to normal buffer size */}}
\DoxyCodeLine{490     \textcolor{keywordflow}{if} (allocated != info-\/>samples*\textcolor{keyword}{sizeof}(mp3d\_sample\_t))}
\DoxyCodeLine{491     \{}
\DoxyCodeLine{492         mp3d\_sample\_t *alloc\_buf = (mp3d\_sample\_t*)realloc(info-\/>buffer, info-\/>samples*\textcolor{keyword}{sizeof}(mp3d\_sample\_t));}
\DoxyCodeLine{493         \textcolor{keywordflow}{if} (!alloc\_buf \&\& info-\/>samples)}
\DoxyCodeLine{494             \textcolor{keywordflow}{return} MP3D\_E\_MEMORY;}
\DoxyCodeLine{495         info-\/>buffer = alloc\_buf;}
\DoxyCodeLine{496     \}}
\DoxyCodeLine{497     \textcolor{keywordflow}{if} (frames)}
\DoxyCodeLine{498         info-\/>avg\_bitrate\_kbps = avg\_bitrate\_kbps/frames;}
\DoxyCodeLine{499     \textcolor{keywordflow}{return} ret;}
\DoxyCodeLine{500 \}}
\DoxyCodeLine{501 }
\DoxyCodeLine{502 \textcolor{keywordtype}{int} mp3dec\_iterate\_buf(\textcolor{keyword}{const} uint8\_t *buf, \textcolor{keywordtype}{size\_t} buf\_size, MP3D\_ITERATE\_CB callback, \textcolor{keywordtype}{void} *user\_data)}
\DoxyCodeLine{503 \{}
\DoxyCodeLine{504     \textcolor{keyword}{const} uint8\_t *orig\_buf = buf;}
\DoxyCodeLine{505     \textcolor{keywordflow}{if} (!buf || (\textcolor{keywordtype}{size\_t})-\/1 == buf\_size || !callback)}
\DoxyCodeLine{506         \textcolor{keywordflow}{return} MP3D\_E\_PARAM;}
\DoxyCodeLine{507     \textcolor{comment}{/* skip id3 */}}
\DoxyCodeLine{508     mp3dec\_skip\_id3(\&buf, \&buf\_size);}
\DoxyCodeLine{509     \textcolor{keywordflow}{if} (!buf\_size)}
\DoxyCodeLine{510         \textcolor{keywordflow}{return} 0;}
\DoxyCodeLine{511     \mbox{\hyperlink{structmp3dec__frame__info__t}{mp3dec\_frame\_info\_t}} frame\_info;}
\DoxyCodeLine{512     memset(\&frame\_info, 0, \textcolor{keyword}{sizeof}(frame\_info));}
\DoxyCodeLine{513     \textcolor{keywordflow}{do}}
\DoxyCodeLine{514     \{}
\DoxyCodeLine{515         \textcolor{keywordtype}{int} free\_format\_bytes = 0, frame\_size = 0, ret;}
\DoxyCodeLine{516         \textcolor{keywordtype}{int} i = mp3d\_find\_frame(buf, buf\_size, \&free\_format\_bytes, \&frame\_size);}
\DoxyCodeLine{517         buf      += i;}
\DoxyCodeLine{518         buf\_size -\/= i;}
\DoxyCodeLine{519         \textcolor{keywordflow}{if} (i \&\& !frame\_size)}
\DoxyCodeLine{520             \textcolor{keywordflow}{continue};}
\DoxyCodeLine{521         \textcolor{keywordflow}{if} (!frame\_size)}
\DoxyCodeLine{522             \textcolor{keywordflow}{break};}
\DoxyCodeLine{523         \textcolor{keyword}{const} uint8\_t *hdr = buf;}
\DoxyCodeLine{524         frame\_info.channels = HDR\_IS\_MONO(hdr) ? 1 : 2;}
\DoxyCodeLine{525         frame\_info.hz = hdr\_sample\_rate\_hz(hdr);}
\DoxyCodeLine{526         frame\_info.layer = 4 -\/ HDR\_GET\_LAYER(hdr);}
\DoxyCodeLine{527         frame\_info.bitrate\_kbps = hdr\_bitrate\_kbps(hdr);}
\DoxyCodeLine{528         frame\_info.frame\_bytes = frame\_size;}
\DoxyCodeLine{529 }
\DoxyCodeLine{530         \textcolor{keywordflow}{if} (callback)}
\DoxyCodeLine{531         \{}
\DoxyCodeLine{532             \textcolor{keywordflow}{if} ((ret = callback(user\_data, hdr, frame\_size, free\_format\_bytes, buf\_size, hdr -\/ orig\_buf, \&frame\_info)))}
\DoxyCodeLine{533                 \textcolor{keywordflow}{return} ret;}
\DoxyCodeLine{534         \}}
\DoxyCodeLine{535         buf      += frame\_size;}
\DoxyCodeLine{536         buf\_size -\/= frame\_size;}
\DoxyCodeLine{537     \} \textcolor{keywordflow}{while} (1);}
\DoxyCodeLine{538     \textcolor{keywordflow}{return} 0;}
\DoxyCodeLine{539 \}}
\DoxyCodeLine{540 }
\DoxyCodeLine{541 \textcolor{keywordtype}{int} mp3dec\_iterate\_cb(\mbox{\hyperlink{structmp3dec__io__t}{mp3dec\_io\_t}} *io, uint8\_t *buf, \textcolor{keywordtype}{size\_t} buf\_size, MP3D\_ITERATE\_CB callback, \textcolor{keywordtype}{void} *user\_data)}
\DoxyCodeLine{542 \{}
\DoxyCodeLine{543     \textcolor{keywordflow}{if} (!io || !buf || (\textcolor{keywordtype}{size\_t})-\/1 == buf\_size || buf\_size < MINIMP3\_BUF\_SIZE || !callback)}
\DoxyCodeLine{544         \textcolor{keywordflow}{return} MP3D\_E\_PARAM;}
\DoxyCodeLine{545     \textcolor{keywordtype}{size\_t} filled = io-\/>read(buf, MINIMP3\_ID3\_DETECT\_SIZE, io-\/>read\_data), consumed = 0;}
\DoxyCodeLine{546     uint64\_t readed = 0;}
\DoxyCodeLine{547     \mbox{\hyperlink{structmp3dec__frame__info__t}{mp3dec\_frame\_info\_t}} frame\_info;}
\DoxyCodeLine{548     \textcolor{keywordtype}{int} eof = 0;}
\DoxyCodeLine{549     memset(\&frame\_info, 0, \textcolor{keyword}{sizeof}(frame\_info));}
\DoxyCodeLine{550     \textcolor{keywordflow}{if} (filled > MINIMP3\_ID3\_DETECT\_SIZE)}
\DoxyCodeLine{551         \textcolor{keywordflow}{return} MP3D\_E\_IOERROR;}
\DoxyCodeLine{552     \textcolor{keywordflow}{if} (MINIMP3\_ID3\_DETECT\_SIZE != filled)}
\DoxyCodeLine{553         \textcolor{keywordflow}{return} 0;}
\DoxyCodeLine{554     \textcolor{keywordtype}{size\_t} id3v2size = mp3dec\_skip\_id3v2(buf, filled);}
\DoxyCodeLine{555     \textcolor{keywordflow}{if} (id3v2size)}
\DoxyCodeLine{556     \{}
\DoxyCodeLine{557         \textcolor{keywordflow}{if} (io-\/>seek(id3v2size, io-\/>seek\_data))}
\DoxyCodeLine{558             \textcolor{keywordflow}{return} MP3D\_E\_IOERROR;}
\DoxyCodeLine{559         filled = io-\/>read(buf, buf\_size, io-\/>read\_data);}
\DoxyCodeLine{560         \textcolor{keywordflow}{if} (filled > buf\_size)}
\DoxyCodeLine{561             \textcolor{keywordflow}{return} MP3D\_E\_IOERROR;}
\DoxyCodeLine{562         readed += id3v2size;}
\DoxyCodeLine{563     \} \textcolor{keywordflow}{else}}
\DoxyCodeLine{564     \{}
\DoxyCodeLine{565         \textcolor{keywordtype}{size\_t} readed = io-\/>read(buf + MINIMP3\_ID3\_DETECT\_SIZE, buf\_size -\/ MINIMP3\_ID3\_DETECT\_SIZE, io-\/>read\_data);}
\DoxyCodeLine{566         \textcolor{keywordflow}{if} (readed > (buf\_size -\/ MINIMP3\_ID3\_DETECT\_SIZE))}
\DoxyCodeLine{567             \textcolor{keywordflow}{return} MP3D\_E\_IOERROR;}
\DoxyCodeLine{568         filled += readed;}
\DoxyCodeLine{569     \}}
\DoxyCodeLine{570     \textcolor{keywordflow}{if} (filled < MINIMP3\_BUF\_SIZE)}
\DoxyCodeLine{571         mp3dec\_skip\_id3v1(buf, \&filled);}
\DoxyCodeLine{572     \textcolor{keywordflow}{do}}
\DoxyCodeLine{573     \{}
\DoxyCodeLine{574         \textcolor{keywordtype}{int} free\_format\_bytes = 0, frame\_size = 0, ret;}
\DoxyCodeLine{575         \textcolor{keywordtype}{int} i = mp3d\_find\_frame(buf + consumed, filled -\/ consumed, \&free\_format\_bytes, \&frame\_size);}
\DoxyCodeLine{576         \textcolor{keywordflow}{if} (i \&\& !frame\_size)}
\DoxyCodeLine{577         \{}
\DoxyCodeLine{578             consumed += i;}
\DoxyCodeLine{579             \textcolor{keywordflow}{continue};}
\DoxyCodeLine{580         \}}
\DoxyCodeLine{581         \textcolor{keywordflow}{if} (!frame\_size)}
\DoxyCodeLine{582             \textcolor{keywordflow}{break};}
\DoxyCodeLine{583         \textcolor{keyword}{const} uint8\_t *hdr = buf + consumed + i;}
\DoxyCodeLine{584         frame\_info.channels = HDR\_IS\_MONO(hdr) ? 1 : 2;}
\DoxyCodeLine{585         frame\_info.hz = hdr\_sample\_rate\_hz(hdr);}
\DoxyCodeLine{586         frame\_info.layer = 4 -\/ HDR\_GET\_LAYER(hdr);}
\DoxyCodeLine{587         frame\_info.bitrate\_kbps = hdr\_bitrate\_kbps(hdr);}
\DoxyCodeLine{588         frame\_info.frame\_bytes = frame\_size;}
\DoxyCodeLine{589 }
\DoxyCodeLine{590         readed += i;}
\DoxyCodeLine{591         \textcolor{keywordflow}{if} (callback)}
\DoxyCodeLine{592         \{}
\DoxyCodeLine{593             \textcolor{keywordflow}{if} ((ret = callback(user\_data, hdr, frame\_size, free\_format\_bytes, filled -\/ consumed, readed, \&frame\_info)))}
\DoxyCodeLine{594                 \textcolor{keywordflow}{return} ret;}
\DoxyCodeLine{595         \}}
\DoxyCodeLine{596         readed += frame\_size;}
\DoxyCodeLine{597         consumed += i + frame\_size;}
\DoxyCodeLine{598         \textcolor{keywordflow}{if} (!eof \&\& filled -\/ consumed < MINIMP3\_BUF\_SIZE)}
\DoxyCodeLine{599         \{   \textcolor{comment}{/* keep minimum 10 consecutive mp3 frames (\string~16KB) worst case */}}
\DoxyCodeLine{600             memmove(buf, buf + consumed, filled -\/ consumed);}
\DoxyCodeLine{601             filled -\/= consumed;}
\DoxyCodeLine{602             consumed = 0;}
\DoxyCodeLine{603             \textcolor{keywordtype}{size\_t} readed = io-\/>read(buf + filled, buf\_size -\/ filled, io-\/>read\_data);}
\DoxyCodeLine{604             \textcolor{keywordflow}{if} (readed > (buf\_size -\/ filled))}
\DoxyCodeLine{605                 \textcolor{keywordflow}{return} MP3D\_E\_IOERROR;}
\DoxyCodeLine{606             \textcolor{keywordflow}{if} (readed != (buf\_size -\/ filled))}
\DoxyCodeLine{607                 eof = 1;}
\DoxyCodeLine{608             filled += readed;}
\DoxyCodeLine{609             \textcolor{keywordflow}{if} (eof)}
\DoxyCodeLine{610                 mp3dec\_skip\_id3v1(buf, \&filled);}
\DoxyCodeLine{611         \}}
\DoxyCodeLine{612     \} \textcolor{keywordflow}{while} (1);}
\DoxyCodeLine{613     \textcolor{keywordflow}{return} 0;}
\DoxyCodeLine{614 \}}
\DoxyCodeLine{615 }
\DoxyCodeLine{616 \textcolor{keyword}{static} \textcolor{keywordtype}{int} mp3dec\_load\_index(\textcolor{keywordtype}{void} *user\_data, \textcolor{keyword}{const} uint8\_t *frame, \textcolor{keywordtype}{int} frame\_size, \textcolor{keywordtype}{int} free\_format\_bytes, \textcolor{keywordtype}{size\_t} buf\_size, uint64\_t offset, \mbox{\hyperlink{structmp3dec__frame__info__t}{mp3dec\_frame\_info\_t}} *info)}
\DoxyCodeLine{617 \{}
\DoxyCodeLine{618     \mbox{\hyperlink{structmp3dec__frame__t}{mp3dec\_frame\_t}} *idx\_frame;}
\DoxyCodeLine{619     \mbox{\hyperlink{structmp3dec__ex__t}{mp3dec\_ex\_t}} *dec = (\mbox{\hyperlink{structmp3dec__ex__t}{mp3dec\_ex\_t}} *)user\_data;}
\DoxyCodeLine{620     \textcolor{keywordflow}{if} (!dec-\/>index.frames \&\& !dec-\/>start\_offset)}
\DoxyCodeLine{621     \{   \textcolor{comment}{/* detect VBR tag and try to avoid full scan */}}
\DoxyCodeLine{622         uint32\_t frames;}
\DoxyCodeLine{623         \textcolor{keywordtype}{int} delay, padding;}
\DoxyCodeLine{624         dec-\/>info = *info;}
\DoxyCodeLine{625         dec-\/>start\_offset = dec-\/>offset = offset;}
\DoxyCodeLine{626         dec-\/>end\_offset   = offset + buf\_size;}
\DoxyCodeLine{627         dec-\/>free\_format\_bytes = free\_format\_bytes; \textcolor{comment}{/* should not change */}}
\DoxyCodeLine{628         \textcolor{keywordflow}{if} (3 == dec-\/>info.layer)}
\DoxyCodeLine{629         \{}
\DoxyCodeLine{630             \textcolor{keywordtype}{int} ret = mp3dec\_check\_vbrtag(frame, frame\_size, \&frames, \&delay, \&padding);}
\DoxyCodeLine{631             \textcolor{keywordflow}{if} (ret)}
\DoxyCodeLine{632                 dec-\/>start\_offset = dec-\/>offset = offset + frame\_size;}
\DoxyCodeLine{633             \textcolor{keywordflow}{if} (ret > 0)}
\DoxyCodeLine{634             \{}
\DoxyCodeLine{635                 padding *= info-\/>channels;}
\DoxyCodeLine{636                 dec-\/>start\_delay = dec-\/>to\_skip = delay*info-\/>channels;}
\DoxyCodeLine{637                 dec-\/>samples = hdr\_frame\_samples(frame)*info-\/>channels*(uint64\_t)frames;}
\DoxyCodeLine{638                 \textcolor{keywordflow}{if} (dec-\/>samples >= (uint64\_t)dec-\/>start\_delay)}
\DoxyCodeLine{639                     dec-\/>samples -\/= dec-\/>start\_delay;}
\DoxyCodeLine{640                 if (padding > 0 \&\& dec-\/>samples >= (uint64\_t)padding)}
\DoxyCodeLine{641                     dec-\/>samples -\/= padding;}
\DoxyCodeLine{642                 dec-\/>detected\_samples = dec-\/>samples;}
\DoxyCodeLine{643                 dec-\/>vbr\_tag\_found = 1;}
\DoxyCodeLine{644                 \textcolor{keywordflow}{return} MP3D\_E\_USER;}
\DoxyCodeLine{645             \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (ret < 0)}
\DoxyCodeLine{646                 \textcolor{keywordflow}{return} 0;}
\DoxyCodeLine{647         \}}
\DoxyCodeLine{648     \}}
\DoxyCodeLine{649     \textcolor{keywordflow}{if} (dec-\/>flags \& MP3D\_DO\_NOT\_SCAN)}
\DoxyCodeLine{650         \textcolor{keywordflow}{return} MP3D\_E\_USER;}
\DoxyCodeLine{651     \textcolor{keywordflow}{if} (dec-\/>index.num\_frames + 1 > dec-\/>index.capacity)}
\DoxyCodeLine{652     \{}
\DoxyCodeLine{653         \textcolor{keywordflow}{if} (!dec-\/>index.capacity)}
\DoxyCodeLine{654             dec-\/>index.capacity = 4096;}
\DoxyCodeLine{655         \textcolor{keywordflow}{else}}
\DoxyCodeLine{656             dec-\/>index.capacity *= 2;}
\DoxyCodeLine{657         \mbox{\hyperlink{structmp3dec__frame__t}{mp3dec\_frame\_t}} *alloc\_buf = (\mbox{\hyperlink{structmp3dec__frame__t}{mp3dec\_frame\_t}} *)realloc((\textcolor{keywordtype}{void}*)dec-\/>index.frames, \textcolor{keyword}{sizeof}(\mbox{\hyperlink{structmp3dec__frame__t}{mp3dec\_frame\_t}})*dec-\/>index.capacity);}
\DoxyCodeLine{658         \textcolor{keywordflow}{if} (!alloc\_buf)}
\DoxyCodeLine{659             \textcolor{keywordflow}{return} MP3D\_E\_MEMORY;}
\DoxyCodeLine{660         dec-\/>index.frames = alloc\_buf;}
\DoxyCodeLine{661     \}}
\DoxyCodeLine{662     idx\_frame = \&dec-\/>index.frames[dec-\/>index.num\_frames++];}
\DoxyCodeLine{663     idx\_frame-\/>offset = offset;}
\DoxyCodeLine{664     idx\_frame-\/>sample = dec-\/>samples;}
\DoxyCodeLine{665     \textcolor{keywordflow}{if} (!dec-\/>buffer\_samples \&\& dec-\/>index.num\_frames < 256)}
\DoxyCodeLine{666     \{   \textcolor{comment}{/* for some cutted mp3 frames, bit-\/reservoir not filled and decoding can't be started from first frames */}}
\DoxyCodeLine{667         \textcolor{comment}{/* try to decode up to 255 first frames till samples starts to decode */}}
\DoxyCodeLine{668         dec-\/>buffer\_samples = mp3dec\_decode\_frame(\&dec-\/>mp3d, frame, MINIMP3\_MIN(buf\_size, (\textcolor{keywordtype}{size\_t})INT\_MAX), dec-\/>buffer, info);}
\DoxyCodeLine{669         dec-\/>samples += dec-\/>buffer\_samples*info-\/>channels;}
\DoxyCodeLine{670     \} \textcolor{keywordflow}{else}}
\DoxyCodeLine{671         dec-\/>samples += hdr\_frame\_samples(frame)*info-\/>channels;}
\DoxyCodeLine{672     \textcolor{keywordflow}{return} 0;}
\DoxyCodeLine{673 \}}
\DoxyCodeLine{674 }
\DoxyCodeLine{675 \textcolor{keywordtype}{int} mp3dec\_ex\_open\_buf(\mbox{\hyperlink{structmp3dec__ex__t}{mp3dec\_ex\_t}} *dec, \textcolor{keyword}{const} uint8\_t *buf, \textcolor{keywordtype}{size\_t} buf\_size, \textcolor{keywordtype}{int} flags)}
\DoxyCodeLine{676 \{}
\DoxyCodeLine{677     \textcolor{keywordflow}{if} (!dec || !buf || (\textcolor{keywordtype}{size\_t})-\/1 == buf\_size || (flags \& (\string~MP3D\_FLAGS\_MASK)))}
\DoxyCodeLine{678         \textcolor{keywordflow}{return} MP3D\_E\_PARAM;}
\DoxyCodeLine{679     memset(dec, 0, \textcolor{keyword}{sizeof}(*dec));}
\DoxyCodeLine{680     dec-\/>file.buffer = buf;}
\DoxyCodeLine{681     dec-\/>file.size   = buf\_size;}
\DoxyCodeLine{682     dec-\/>flags       = flags;}
\DoxyCodeLine{683     mp3dec\_init(\&dec-\/>mp3d);}
\DoxyCodeLine{684     \textcolor{keywordtype}{int} ret = mp3dec\_iterate\_buf(dec-\/>file.buffer, dec-\/>file.size, mp3dec\_load\_index, dec);}
\DoxyCodeLine{685     \textcolor{keywordflow}{if} (ret \&\& MP3D\_E\_USER != ret)}
\DoxyCodeLine{686         \textcolor{keywordflow}{return} ret;}
\DoxyCodeLine{687     mp3dec\_init(\&dec-\/>mp3d);}
\DoxyCodeLine{688     dec-\/>buffer\_samples = 0;}
\DoxyCodeLine{689     dec-\/>indexes\_built = !(dec-\/>vbr\_tag\_found || (flags \& MP3D\_DO\_NOT\_SCAN));}
\DoxyCodeLine{690     dec-\/>flags \&= (\string~MP3D\_DO\_NOT\_SCAN);}
\DoxyCodeLine{691     \textcolor{keywordflow}{return} 0;}
\DoxyCodeLine{692 \}}
\DoxyCodeLine{693 }
\DoxyCodeLine{694 \textcolor{preprocessor}{\#ifndef MINIMP3\_SEEK\_IDX\_LINEAR\_SEARCH}}
\DoxyCodeLine{695 \textcolor{keyword}{static} \textcolor{keywordtype}{size\_t} mp3dec\_idx\_binary\_search(\mbox{\hyperlink{structmp3dec__index__t}{mp3dec\_index\_t}} *idx, uint64\_t position)}
\DoxyCodeLine{696 \{}
\DoxyCodeLine{697     \textcolor{keywordtype}{size\_t} end = idx-\/>num\_frames, start = 0, index = 0;}
\DoxyCodeLine{698     \textcolor{keywordflow}{while} (start <= end)}
\DoxyCodeLine{699     \{}
\DoxyCodeLine{700         \textcolor{keywordtype}{size\_t} mid = (start + end) / 2;}
\DoxyCodeLine{701         \textcolor{keywordflow}{if} (idx-\/>frames[mid].sample >= position)}
\DoxyCodeLine{702         \{   \textcolor{comment}{/* move left side. */}}
\DoxyCodeLine{703             \textcolor{keywordflow}{if} (idx-\/>frames[mid].sample == position)}
\DoxyCodeLine{704                 \textcolor{keywordflow}{return} mid;}
\DoxyCodeLine{705             end = mid -\/ 1;}
\DoxyCodeLine{706         \}  \textcolor{keywordflow}{else}}
\DoxyCodeLine{707         \{   \textcolor{comment}{/* move to right side */}}
\DoxyCodeLine{708             index = mid;}
\DoxyCodeLine{709             start = mid + 1;}
\DoxyCodeLine{710             \textcolor{keywordflow}{if} (start == idx-\/>num\_frames)}
\DoxyCodeLine{711                 \textcolor{keywordflow}{break};}
\DoxyCodeLine{712         \}}
\DoxyCodeLine{713     \}}
\DoxyCodeLine{714     \textcolor{keywordflow}{return} index;}
\DoxyCodeLine{715 \}}
\DoxyCodeLine{716 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{717 }
\DoxyCodeLine{718 \textcolor{keywordtype}{int} mp3dec\_ex\_seek(\mbox{\hyperlink{structmp3dec__ex__t}{mp3dec\_ex\_t}} *dec, uint64\_t position)}
\DoxyCodeLine{719 \{}
\DoxyCodeLine{720     \textcolor{keywordtype}{size\_t} i;}
\DoxyCodeLine{721     \textcolor{keywordflow}{if} (!dec)}
\DoxyCodeLine{722         \textcolor{keywordflow}{return} MP3D\_E\_PARAM;}
\DoxyCodeLine{723     \textcolor{keywordflow}{if} (!(dec-\/>flags \& MP3D\_SEEK\_TO\_SAMPLE))}
\DoxyCodeLine{724     \{}
\DoxyCodeLine{725         \textcolor{keywordflow}{if} (dec-\/>io)}
\DoxyCodeLine{726         \{}
\DoxyCodeLine{727             dec-\/>offset = position;}
\DoxyCodeLine{728         \} \textcolor{keywordflow}{else}}
\DoxyCodeLine{729         \{}
\DoxyCodeLine{730             dec-\/>offset = MINIMP3\_MIN(position, dec-\/>file.size);}
\DoxyCodeLine{731         \}}
\DoxyCodeLine{732         dec-\/>cur\_sample = 0;}
\DoxyCodeLine{733         \textcolor{keywordflow}{goto} do\_exit;}
\DoxyCodeLine{734     \}}
\DoxyCodeLine{735     dec-\/>cur\_sample = position;}
\DoxyCodeLine{736     position += dec-\/>start\_delay;}
\DoxyCodeLine{737     \textcolor{keywordflow}{if} (0 == position)}
\DoxyCodeLine{738     \{   \textcolor{comment}{/* optimize seek to zero, no index needed */}}
\DoxyCodeLine{739 seek\_zero:}
\DoxyCodeLine{740         dec-\/>offset  = dec-\/>start\_offset;}
\DoxyCodeLine{741         dec-\/>to\_skip = 0;}
\DoxyCodeLine{742         \textcolor{keywordflow}{goto} do\_exit;}
\DoxyCodeLine{743     \}}
\DoxyCodeLine{744     \textcolor{keywordflow}{if} (!dec-\/>indexes\_built)}
\DoxyCodeLine{745     \{   \textcolor{comment}{/* no index created yet (vbr tag used to calculate track length or MP3D\_DO\_NOT\_SCAN open flag used) */}}
\DoxyCodeLine{746         dec-\/>indexes\_built = 1;}
\DoxyCodeLine{747         dec-\/>samples = 0;}
\DoxyCodeLine{748         dec-\/>buffer\_samples = 0;}
\DoxyCodeLine{749         \textcolor{keywordflow}{if} (dec-\/>io)}
\DoxyCodeLine{750         \{}
\DoxyCodeLine{751             \textcolor{keywordflow}{if} (dec-\/>io-\/>seek(dec-\/>start\_offset, dec-\/>io-\/>seek\_data))}
\DoxyCodeLine{752                 \textcolor{keywordflow}{return} MP3D\_E\_IOERROR;}
\DoxyCodeLine{753             \textcolor{keywordtype}{int} ret = mp3dec\_iterate\_cb(dec-\/>io, (uint8\_t *)dec-\/>file.buffer, dec-\/>file.size, mp3dec\_load\_index, dec);}
\DoxyCodeLine{754             \textcolor{keywordflow}{if} (ret \&\& MP3D\_E\_USER != ret)}
\DoxyCodeLine{755                 \textcolor{keywordflow}{return} ret;}
\DoxyCodeLine{756         \} \textcolor{keywordflow}{else}}
\DoxyCodeLine{757         \{}
\DoxyCodeLine{758             \textcolor{keywordtype}{int} ret = mp3dec\_iterate\_buf(dec-\/>file.buffer + dec-\/>start\_offset, dec-\/>file.size -\/ dec-\/>start\_offset, mp3dec\_load\_index, dec);}
\DoxyCodeLine{759             \textcolor{keywordflow}{if} (ret \&\& MP3D\_E\_USER != ret)}
\DoxyCodeLine{760                 \textcolor{keywordflow}{return} ret;}
\DoxyCodeLine{761         \}}
\DoxyCodeLine{762         \textcolor{keywordflow}{for} (i = 0; i < dec-\/>index.num\_frames; i++)}
\DoxyCodeLine{763             dec-\/>index.frames[i].offset += dec-\/>start\_offset;}
\DoxyCodeLine{764         dec-\/>samples = dec-\/>detected\_samples;}
\DoxyCodeLine{765     \}}
\DoxyCodeLine{766     \textcolor{keywordflow}{if} (!dec-\/>index.frames)}
\DoxyCodeLine{767         \textcolor{keywordflow}{goto} seek\_zero; \textcolor{comment}{/* no frames in file -\/ seek to zero */}}
\DoxyCodeLine{768 \textcolor{preprocessor}{\#ifdef MINIMP3\_SEEK\_IDX\_LINEAR\_SEARCH}}
\DoxyCodeLine{769     \textcolor{keywordflow}{for} (i = 0; i < dec-\/>index.num\_frames; i++)}
\DoxyCodeLine{770     \{}
\DoxyCodeLine{771         \textcolor{keywordflow}{if} (dec-\/>index.frames[i].sample >= position)}
\DoxyCodeLine{772             \textcolor{keywordflow}{break};}
\DoxyCodeLine{773     \}}
\DoxyCodeLine{774 \textcolor{preprocessor}{\#else}}
\DoxyCodeLine{775     i = mp3dec\_idx\_binary\_search(\&dec-\/>index, position);}
\DoxyCodeLine{776 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{777     \textcolor{keywordflow}{if} (i)}
\DoxyCodeLine{778     \{}
\DoxyCodeLine{779         \textcolor{keywordtype}{int} to\_fill\_bytes = 511;}
\DoxyCodeLine{780         \textcolor{keywordtype}{int} skip\_frames = MINIMP3\_PREDECODE\_FRAMES}
\DoxyCodeLine{781 \textcolor{preprocessor}{\#ifdef MINIMP3\_SEEK\_IDX\_LINEAR\_SEARCH}}
\DoxyCodeLine{782          + ((dec-\/>index.frames[i].sample == position) ? 0 : 1)}
\DoxyCodeLine{783 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{784         ;}
\DoxyCodeLine{785         i -\/= MINIMP3\_MIN(i, (\textcolor{keywordtype}{size\_t})skip\_frames);}
\DoxyCodeLine{786         \textcolor{keywordflow}{if} (3 == dec-\/>info.layer)}
\DoxyCodeLine{787         \{}
\DoxyCodeLine{788             \textcolor{keywordflow}{while} (i \&\& to\_fill\_bytes)}
\DoxyCodeLine{789             \{   \textcolor{comment}{/* make sure bit-\/reservoir is filled when we start decoding */}}
\DoxyCodeLine{790                 bs\_t bs[1];}
\DoxyCodeLine{791                 L3\_gr\_info\_t gr\_info[4];}
\DoxyCodeLine{792                 \textcolor{keywordtype}{int} frame\_bytes, frame\_size;}
\DoxyCodeLine{793                 \textcolor{keyword}{const} uint8\_t *hdr;}
\DoxyCodeLine{794                 \textcolor{keywordflow}{if} (dec-\/>io)}
\DoxyCodeLine{795                 \{}
\DoxyCodeLine{796                     hdr = dec-\/>file.buffer;}
\DoxyCodeLine{797                     \textcolor{keywordflow}{if} (dec-\/>io-\/>seek(dec-\/>index.frames[i -\/ 1].offset, dec-\/>io-\/>seek\_data))}
\DoxyCodeLine{798                         \textcolor{keywordflow}{return} MP3D\_E\_IOERROR;}
\DoxyCodeLine{799                     \textcolor{keywordtype}{size\_t} readed = dec-\/>io-\/>read((uint8\_t *)hdr, HDR\_SIZE, dec-\/>io-\/>read\_data);}
\DoxyCodeLine{800                     \textcolor{keywordflow}{if} (readed != HDR\_SIZE)}
\DoxyCodeLine{801                         \textcolor{keywordflow}{return} MP3D\_E\_IOERROR;}
\DoxyCodeLine{802                     frame\_size = hdr\_frame\_bytes(hdr, dec-\/>free\_format\_bytes) + hdr\_padding(hdr);}
\DoxyCodeLine{803                     readed = dec-\/>io-\/>read((uint8\_t *)hdr + HDR\_SIZE, frame\_size -\/ HDR\_SIZE, dec-\/>io-\/>read\_data);}
\DoxyCodeLine{804                     \textcolor{keywordflow}{if} (readed != (\textcolor{keywordtype}{size\_t})(frame\_size -\/ HDR\_SIZE))}
\DoxyCodeLine{805                         \textcolor{keywordflow}{return} MP3D\_E\_IOERROR;}
\DoxyCodeLine{806                     bs\_init(bs, hdr + HDR\_SIZE, frame\_size -\/ HDR\_SIZE);}
\DoxyCodeLine{807                 \} \textcolor{keywordflow}{else}}
\DoxyCodeLine{808                 \{}
\DoxyCodeLine{809                     hdr = dec-\/>file.buffer + dec-\/>index.frames[i -\/ 1].offset;}
\DoxyCodeLine{810                     frame\_size = hdr\_frame\_bytes(hdr, dec-\/>free\_format\_bytes) + hdr\_padding(hdr);}
\DoxyCodeLine{811                     bs\_init(bs, hdr + HDR\_SIZE, frame\_size -\/ HDR\_SIZE);}
\DoxyCodeLine{812                 \}}
\DoxyCodeLine{813                 \textcolor{keywordflow}{if} (HDR\_IS\_CRC(hdr))}
\DoxyCodeLine{814                     get\_bits(bs, 16);}
\DoxyCodeLine{815                 i-\/-\/;}
\DoxyCodeLine{816                 \textcolor{keywordflow}{if} (L3\_read\_side\_info(bs, gr\_info, hdr) < 0)}
\DoxyCodeLine{817                     \textcolor{keywordflow}{break}; \textcolor{comment}{/* frame not decodable, we can start from here */}}
\DoxyCodeLine{818                 frame\_bytes = (bs-\/>limit -\/ bs-\/>pos)/8;}
\DoxyCodeLine{819                 to\_fill\_bytes -\/= MINIMP3\_MIN(to\_fill\_bytes, frame\_bytes);}
\DoxyCodeLine{820             \}}
\DoxyCodeLine{821         \}}
\DoxyCodeLine{822     \}}
\DoxyCodeLine{823     dec-\/>offset = dec-\/>index.frames[i].offset;}
\DoxyCodeLine{824     dec-\/>to\_skip = position -\/ dec-\/>index.frames[i].sample;}
\DoxyCodeLine{825     \textcolor{keywordflow}{while} ((i + 1) < dec-\/>index.num\_frames \&\& !dec-\/>index.frames[i].sample \&\& !dec-\/>index.frames[i + 1].sample)}
\DoxyCodeLine{826     \{   \textcolor{comment}{/* skip not decodable first frames */}}
\DoxyCodeLine{827         \textcolor{keyword}{const} uint8\_t *hdr;}
\DoxyCodeLine{828         \textcolor{keywordflow}{if} (dec-\/>io)}
\DoxyCodeLine{829         \{}
\DoxyCodeLine{830             hdr = dec-\/>file.buffer;}
\DoxyCodeLine{831             \textcolor{keywordflow}{if} (dec-\/>io-\/>seek(dec-\/>index.frames[i].offset, dec-\/>io-\/>seek\_data))}
\DoxyCodeLine{832                 \textcolor{keywordflow}{return} MP3D\_E\_IOERROR;}
\DoxyCodeLine{833             \textcolor{keywordtype}{size\_t} readed = dec-\/>io-\/>read((uint8\_t *)hdr, HDR\_SIZE, dec-\/>io-\/>read\_data);}
\DoxyCodeLine{834             \textcolor{keywordflow}{if} (readed != HDR\_SIZE)}
\DoxyCodeLine{835                 \textcolor{keywordflow}{return} MP3D\_E\_IOERROR;}
\DoxyCodeLine{836         \} \textcolor{keywordflow}{else}}
\DoxyCodeLine{837             hdr = dec-\/>file.buffer + dec-\/>index.frames[i].offset;}
\DoxyCodeLine{838         dec-\/>to\_skip += hdr\_frame\_samples(hdr)*dec-\/>info.channels;}
\DoxyCodeLine{839         i++;}
\DoxyCodeLine{840     \}}
\DoxyCodeLine{841 do\_exit:}
\DoxyCodeLine{842     \textcolor{keywordflow}{if} (dec-\/>io)}
\DoxyCodeLine{843     \{}
\DoxyCodeLine{844         \textcolor{keywordflow}{if} (dec-\/>io-\/>seek(dec-\/>offset, dec-\/>io-\/>seek\_data))}
\DoxyCodeLine{845             \textcolor{keywordflow}{return} MP3D\_E\_IOERROR;}
\DoxyCodeLine{846     \}}
\DoxyCodeLine{847     dec-\/>buffer\_samples  = 0;}
\DoxyCodeLine{848     dec-\/>buffer\_consumed = 0;}
\DoxyCodeLine{849     dec-\/>input\_consumed  = 0;}
\DoxyCodeLine{850     dec-\/>input\_filled    = 0;}
\DoxyCodeLine{851     dec-\/>last\_error      = 0;}
\DoxyCodeLine{852     mp3dec\_init(\&dec-\/>mp3d);}
\DoxyCodeLine{853     \textcolor{keywordflow}{return} 0;}
\DoxyCodeLine{854 \}}
\DoxyCodeLine{855 }
\DoxyCodeLine{856 \textcolor{keywordtype}{size\_t} mp3dec\_ex\_read\_frame(\mbox{\hyperlink{structmp3dec__ex__t}{mp3dec\_ex\_t}} *dec, mp3d\_sample\_t **buf, \mbox{\hyperlink{structmp3dec__frame__info__t}{mp3dec\_frame\_info\_t}} *frame\_info, \textcolor{keywordtype}{size\_t} max\_samples)}
\DoxyCodeLine{857 \{}
\DoxyCodeLine{858     \textcolor{keywordflow}{if} (!dec || !buf || !frame\_info)}
\DoxyCodeLine{859     \{}
\DoxyCodeLine{860         \textcolor{keywordflow}{if} (dec)}
\DoxyCodeLine{861             dec-\/>last\_error = MP3D\_E\_PARAM;}
\DoxyCodeLine{862         \textcolor{keywordflow}{return} 0;}
\DoxyCodeLine{863     \}}
\DoxyCodeLine{864     \textcolor{keywordflow}{if} (dec-\/>detected\_samples \&\& dec-\/>cur\_sample >= dec-\/>detected\_samples)}
\DoxyCodeLine{865         \textcolor{keywordflow}{return} 0; \textcolor{comment}{/* at end of stream */}}
\DoxyCodeLine{866     \textcolor{keywordflow}{if} (dec-\/>last\_error)}
\DoxyCodeLine{867         \textcolor{keywordflow}{return} 0; \textcolor{comment}{/* error eof state, seek can reset it */}}
\DoxyCodeLine{868     *buf = NULL;}
\DoxyCodeLine{869     uint64\_t end\_offset = dec-\/>end\_offset ? dec-\/>end\_offset : dec-\/>file.size;}
\DoxyCodeLine{870     \textcolor{keywordtype}{int} eof = 0;}
\DoxyCodeLine{871     \textcolor{keywordflow}{while} (dec-\/>buffer\_consumed == dec-\/>buffer\_samples)}
\DoxyCodeLine{872     \{}
\DoxyCodeLine{873         \textcolor{keyword}{const} uint8\_t *dec\_buf;}
\DoxyCodeLine{874         \textcolor{keywordflow}{if} (dec-\/>io)}
\DoxyCodeLine{875         \{}
\DoxyCodeLine{876             \textcolor{keywordflow}{if} (!eof \&\& (dec-\/>input\_filled -\/ dec-\/>input\_consumed) < MINIMP3\_BUF\_SIZE)}
\DoxyCodeLine{877             \{   \textcolor{comment}{/* keep minimum 10 consecutive mp3 frames (\string~16KB) worst case */}}
\DoxyCodeLine{878                 memmove((uint8\_t*)dec-\/>file.buffer, (uint8\_t*)dec-\/>file.buffer + dec-\/>input\_consumed, dec-\/>input\_filled -\/ dec-\/>input\_consumed);}
\DoxyCodeLine{879                 dec-\/>input\_filled -\/= dec-\/>input\_consumed;}
\DoxyCodeLine{880                 dec-\/>input\_consumed = 0;}
\DoxyCodeLine{881                 \textcolor{keywordtype}{size\_t} readed = dec-\/>io-\/>read((uint8\_t*)dec-\/>file.buffer + dec-\/>input\_filled, dec-\/>file.size -\/ dec-\/>input\_filled, dec-\/>io-\/>read\_data);}
\DoxyCodeLine{882                 \textcolor{keywordflow}{if} (readed > (dec-\/>file.size -\/ dec-\/>input\_filled))}
\DoxyCodeLine{883                 \{}
\DoxyCodeLine{884                     dec-\/>last\_error = MP3D\_E\_IOERROR;}
\DoxyCodeLine{885                     readed = 0;}
\DoxyCodeLine{886                 \}}
\DoxyCodeLine{887                 \textcolor{keywordflow}{if} (readed != (dec-\/>file.size -\/ dec-\/>input\_filled))}
\DoxyCodeLine{888                     eof = 1;}
\DoxyCodeLine{889                 dec-\/>input\_filled += readed;}
\DoxyCodeLine{890                 \textcolor{keywordflow}{if} (eof)}
\DoxyCodeLine{891                     mp3dec\_skip\_id3v1((uint8\_t*)dec-\/>file.buffer, \&dec-\/>input\_filled);}
\DoxyCodeLine{892             \}}
\DoxyCodeLine{893             dec\_buf = dec-\/>file.buffer + dec-\/>input\_consumed;}
\DoxyCodeLine{894             \textcolor{keywordflow}{if} (!(dec-\/>input\_filled -\/ dec-\/>input\_consumed))}
\DoxyCodeLine{895                 \textcolor{keywordflow}{return} 0;}
\DoxyCodeLine{896             dec-\/>buffer\_samples = mp3dec\_decode\_frame(\&dec-\/>mp3d, dec\_buf, dec-\/>input\_filled -\/ dec-\/>input\_consumed, dec-\/>buffer, frame\_info);}
\DoxyCodeLine{897             dec-\/>input\_consumed += frame\_info-\/>frame\_bytes;}
\DoxyCodeLine{898         \} \textcolor{keywordflow}{else}}
\DoxyCodeLine{899         \{}
\DoxyCodeLine{900             dec\_buf = dec-\/>file.buffer + dec-\/>offset;}
\DoxyCodeLine{901             uint64\_t buf\_size = end\_offset -\/ dec-\/>offset;}
\DoxyCodeLine{902             \textcolor{keywordflow}{if} (!buf\_size)}
\DoxyCodeLine{903                 \textcolor{keywordflow}{return} 0;}
\DoxyCodeLine{904             dec-\/>buffer\_samples = mp3dec\_decode\_frame(\&dec-\/>mp3d, dec\_buf, MINIMP3\_MIN(buf\_size, (uint64\_t)INT\_MAX), dec-\/>buffer, frame\_info);}
\DoxyCodeLine{905         \}}
\DoxyCodeLine{906         dec-\/>buffer\_consumed = 0;}
\DoxyCodeLine{907         \textcolor{keywordflow}{if} (dec-\/>info.hz != frame\_info-\/>hz || dec-\/>info.layer != frame\_info-\/>layer)}
\DoxyCodeLine{908         \{}
\DoxyCodeLine{909 return\_e\_decode:}
\DoxyCodeLine{910             dec-\/>last\_error = MP3D\_E\_DECODE;}
\DoxyCodeLine{911             \textcolor{keywordflow}{return} 0;}
\DoxyCodeLine{912         \}}
\DoxyCodeLine{913         \textcolor{keywordflow}{if} (dec-\/>buffer\_samples)}
\DoxyCodeLine{914         \{}
\DoxyCodeLine{915             dec-\/>buffer\_samples *= frame\_info-\/>channels;}
\DoxyCodeLine{916             \textcolor{keywordflow}{if} (dec-\/>to\_skip)}
\DoxyCodeLine{917             \{}
\DoxyCodeLine{918                 \textcolor{keywordtype}{size\_t} skip = MINIMP3\_MIN(dec-\/>buffer\_samples, dec-\/>to\_skip);}
\DoxyCodeLine{919                 dec-\/>buffer\_consumed += skip;}
\DoxyCodeLine{920                 dec-\/>to\_skip -\/= skip;}
\DoxyCodeLine{921             \}}
\DoxyCodeLine{922             \textcolor{keywordflow}{if} (}
\DoxyCodeLine{923 \#ifdef MINIMP3\_ALLOW\_MONO\_STEREO\_TRANSITION}
\DoxyCodeLine{924                 !(dec-\/>flags \& MP3D\_ALLOW\_MONO\_STEREO\_TRANSITION) \&\&}
\DoxyCodeLine{925 \#endif}
\DoxyCodeLine{926                 dec-\/>buffer\_consumed != dec-\/>buffer\_samples \&\& dec-\/>info.channels != frame\_info-\/>channels)}
\DoxyCodeLine{927             \{}
\DoxyCodeLine{928                 \textcolor{keywordflow}{goto} return\_e\_decode;}
\DoxyCodeLine{929             \}}
\DoxyCodeLine{930         \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (dec-\/>to\_skip)}
\DoxyCodeLine{931         \{   \textcolor{comment}{/* In mp3 decoding not always can start decode from any frame because of bit reservoir,}}
\DoxyCodeLine{932 \textcolor{comment}{               count skip samples for such frames */}}
\DoxyCodeLine{933             \textcolor{keywordtype}{int} frame\_samples = hdr\_frame\_samples(dec\_buf)*frame\_info-\/>channels;}
\DoxyCodeLine{934             dec-\/>to\_skip -\/= MINIMP3\_MIN(frame\_samples, dec-\/>to\_skip);}
\DoxyCodeLine{935         \}}
\DoxyCodeLine{936         dec-\/>offset += frame\_info-\/>frame\_bytes;}
\DoxyCodeLine{937     \}}
\DoxyCodeLine{938     \textcolor{keywordtype}{size\_t} out\_samples = MINIMP3\_MIN((\textcolor{keywordtype}{size\_t})(dec-\/>buffer\_samples -\/ dec-\/>buffer\_consumed), max\_samples);}
\DoxyCodeLine{939     \textcolor{keywordflow}{if} (dec-\/>detected\_samples)}
\DoxyCodeLine{940     \{   \textcolor{comment}{/* count decoded samples to properly cut padding */}}
\DoxyCodeLine{941         \textcolor{keywordflow}{if} (dec-\/>cur\_sample + out\_samples >= dec-\/>detected\_samples)}
\DoxyCodeLine{942             out\_samples = dec-\/>detected\_samples -\/ dec-\/>cur\_sample;}
\DoxyCodeLine{943     \}}
\DoxyCodeLine{944     dec-\/>cur\_sample += out\_samples;}
\DoxyCodeLine{945     *buf = dec-\/>buffer + dec-\/>buffer\_consumed;}
\DoxyCodeLine{946     dec-\/>buffer\_consumed += out\_samples;}
\DoxyCodeLine{947     \textcolor{keywordflow}{return} out\_samples;}
\DoxyCodeLine{948 \}}
\DoxyCodeLine{949 }
\DoxyCodeLine{950 \textcolor{keywordtype}{size\_t} mp3dec\_ex\_read(\mbox{\hyperlink{structmp3dec__ex__t}{mp3dec\_ex\_t}} *dec, mp3d\_sample\_t *buf, \textcolor{keywordtype}{size\_t} samples)}
\DoxyCodeLine{951 \{}
\DoxyCodeLine{952     \textcolor{keywordflow}{if} (!dec || !buf)}
\DoxyCodeLine{953     \{}
\DoxyCodeLine{954         \textcolor{keywordflow}{if} (dec)}
\DoxyCodeLine{955             dec-\/>last\_error = MP3D\_E\_PARAM;}
\DoxyCodeLine{956         \textcolor{keywordflow}{return} 0;}
\DoxyCodeLine{957     \}}
\DoxyCodeLine{958     \mbox{\hyperlink{structmp3dec__frame__info__t}{mp3dec\_frame\_info\_t}} frame\_info;}
\DoxyCodeLine{959     memset(\&frame\_info, 0, \textcolor{keyword}{sizeof}(frame\_info));}
\DoxyCodeLine{960     \textcolor{keywordtype}{size\_t} samples\_requested = samples;}
\DoxyCodeLine{961     \textcolor{keywordflow}{while} (samples)}
\DoxyCodeLine{962     \{}
\DoxyCodeLine{963         mp3d\_sample\_t *buf\_frame = NULL;}
\DoxyCodeLine{964         \textcolor{keywordtype}{size\_t} read\_samples = mp3dec\_ex\_read\_frame(dec, \&buf\_frame, \&frame\_info, samples);}
\DoxyCodeLine{965         \textcolor{keywordflow}{if} (!read\_samples)}
\DoxyCodeLine{966         \{}
\DoxyCodeLine{967             \textcolor{keywordflow}{break};}
\DoxyCodeLine{968         \}}
\DoxyCodeLine{969         memcpy(buf, buf\_frame, read\_samples * \textcolor{keyword}{sizeof}(mp3d\_sample\_t));}
\DoxyCodeLine{970         buf += read\_samples;}
\DoxyCodeLine{971         samples -\/= read\_samples;}
\DoxyCodeLine{972     \}}
\DoxyCodeLine{973     \textcolor{keywordflow}{return} samples\_requested -\/ samples;}
\DoxyCodeLine{974 \}}
\DoxyCodeLine{975 }
\DoxyCodeLine{976 \textcolor{keywordtype}{int} mp3dec\_ex\_open\_cb(\mbox{\hyperlink{structmp3dec__ex__t}{mp3dec\_ex\_t}} *dec, \mbox{\hyperlink{structmp3dec__io__t}{mp3dec\_io\_t}} *io, \textcolor{keywordtype}{int} flags)}
\DoxyCodeLine{977 \{}
\DoxyCodeLine{978     \textcolor{keywordflow}{if} (!dec || !io || (flags \& (\string~MP3D\_FLAGS\_MASK)))}
\DoxyCodeLine{979         \textcolor{keywordflow}{return} MP3D\_E\_PARAM;}
\DoxyCodeLine{980     memset(dec, 0, \textcolor{keyword}{sizeof}(*dec));}
\DoxyCodeLine{981 \textcolor{preprocessor}{\#ifdef MINIMP3\_HAVE\_RING}}
\DoxyCodeLine{982     \textcolor{keywordtype}{int} ret;}
\DoxyCodeLine{983     \textcolor{keywordflow}{if} (ret = mp3dec\_open\_ring(\&dec-\/>file, MINIMP3\_IO\_SIZE))}
\DoxyCodeLine{984         \textcolor{keywordflow}{return} ret;}
\DoxyCodeLine{985 \textcolor{preprocessor}{\#else}}
\DoxyCodeLine{986     dec-\/>file.size = MINIMP3\_IO\_SIZE;}
\DoxyCodeLine{987     dec-\/>file.buffer = (\textcolor{keyword}{const} uint8\_t*)malloc(dec-\/>file.size);}
\DoxyCodeLine{988     \textcolor{keywordflow}{if} (!dec-\/>file.buffer)}
\DoxyCodeLine{989         \textcolor{keywordflow}{return} MP3D\_E\_MEMORY;}
\DoxyCodeLine{990 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{991     dec-\/>flags = flags;}
\DoxyCodeLine{992     dec-\/>io = io;}
\DoxyCodeLine{993     mp3dec\_init(\&dec-\/>mp3d);}
\DoxyCodeLine{994     \textcolor{keywordflow}{if} (io-\/>seek(0, io-\/>seek\_data))}
\DoxyCodeLine{995         \textcolor{keywordflow}{return} MP3D\_E\_IOERROR;}
\DoxyCodeLine{996     \textcolor{keywordtype}{int} ret = mp3dec\_iterate\_cb(io, (uint8\_t *)dec-\/>file.buffer, dec-\/>file.size, mp3dec\_load\_index, dec);}
\DoxyCodeLine{997     \textcolor{keywordflow}{if} (ret \&\& MP3D\_E\_USER != ret)}
\DoxyCodeLine{998         \textcolor{keywordflow}{return} ret;}
\DoxyCodeLine{999     \textcolor{keywordflow}{if} (dec-\/>io-\/>seek(dec-\/>start\_offset, dec-\/>io-\/>seek\_data))}
\DoxyCodeLine{1000         \textcolor{keywordflow}{return} MP3D\_E\_IOERROR;}
\DoxyCodeLine{1001     mp3dec\_init(\&dec-\/>mp3d);}
\DoxyCodeLine{1002     dec-\/>buffer\_samples = 0;}
\DoxyCodeLine{1003     dec-\/>indexes\_built = !(dec-\/>vbr\_tag\_found || (flags \& MP3D\_DO\_NOT\_SCAN));}
\DoxyCodeLine{1004     dec-\/>flags \&= (\string~MP3D\_DO\_NOT\_SCAN);}
\DoxyCodeLine{1005     \textcolor{keywordflow}{return} 0;}
\DoxyCodeLine{1006 \}}
\DoxyCodeLine{1007 }
\DoxyCodeLine{1008 }
\DoxyCodeLine{1009 \textcolor{preprocessor}{\#ifndef MINIMP3\_NO\_STDIO}}
\DoxyCodeLine{1010 }
\DoxyCodeLine{1011 \textcolor{preprocessor}{\#if defined(\_\_linux\_\_) || defined(\_\_FreeBSD\_\_)}}
\DoxyCodeLine{1012 \textcolor{preprocessor}{\#include <errno.h>}}
\DoxyCodeLine{1013 \textcolor{preprocessor}{\#include <sys/mman.h>}}
\DoxyCodeLine{1014 \textcolor{preprocessor}{\#include <sys/types.h>}}
\DoxyCodeLine{1015 \textcolor{preprocessor}{\#include <sys/stat.h>}}
\DoxyCodeLine{1016 \textcolor{preprocessor}{\#include <unistd.h>}}
\DoxyCodeLine{1017 \textcolor{preprocessor}{\#include <fcntl.h>}}
\DoxyCodeLine{1018 \textcolor{preprocessor}{\#if !defined(\_GNU\_SOURCE)}}
\DoxyCodeLine{1019 \textcolor{preprocessor}{\#include <sys/ipc.h>}}
\DoxyCodeLine{1020 \textcolor{preprocessor}{\#include <sys/shm.h>}}
\DoxyCodeLine{1021 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{1022 \textcolor{preprocessor}{\#if !defined(MAP\_POPULATE) \&\& defined(\_\_linux\_\_)}}
\DoxyCodeLine{1023 \textcolor{preprocessor}{\#define MAP\_POPULATE 0x08000}}
\DoxyCodeLine{1024 \textcolor{preprocessor}{\#elif !defined(MAP\_POPULATE)}}
\DoxyCodeLine{1025 \textcolor{preprocessor}{\#define MAP\_POPULATE 0}}
\DoxyCodeLine{1026 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{1027 }
\DoxyCodeLine{1028 \textcolor{keyword}{static} \textcolor{keywordtype}{void} mp3dec\_close\_file(\mbox{\hyperlink{structmp3dec__map__info__t}{mp3dec\_map\_info\_t}} *map\_info)}
\DoxyCodeLine{1029 \{}
\DoxyCodeLine{1030     \textcolor{keywordflow}{if} (map\_info-\/>buffer \&\& MAP\_FAILED != map\_info-\/>buffer)}
\DoxyCodeLine{1031         munmap((\textcolor{keywordtype}{void} *)map\_info-\/>buffer, map\_info-\/>size);}
\DoxyCodeLine{1032     map\_info-\/>buffer = 0;}
\DoxyCodeLine{1033     map\_info-\/>size   = 0;}
\DoxyCodeLine{1034 \}}
\DoxyCodeLine{1035 }
\DoxyCodeLine{1036 \textcolor{keyword}{static} \textcolor{keywordtype}{int} mp3dec\_open\_file(\textcolor{keyword}{const} \textcolor{keywordtype}{char} *file\_name, \mbox{\hyperlink{structmp3dec__map__info__t}{mp3dec\_map\_info\_t}} *map\_info)}
\DoxyCodeLine{1037 \{}
\DoxyCodeLine{1038     \textcolor{keywordflow}{if} (!file\_name)}
\DoxyCodeLine{1039         \textcolor{keywordflow}{return} MP3D\_E\_PARAM;}
\DoxyCodeLine{1040     \textcolor{keywordtype}{int} file;}
\DoxyCodeLine{1041     \textcolor{keyword}{struct }stat st;}
\DoxyCodeLine{1042     memset(map\_info, 0, \textcolor{keyword}{sizeof}(*map\_info));}
\DoxyCodeLine{1043 retry\_open:}
\DoxyCodeLine{1044     file = open(file\_name, O\_RDONLY);}
\DoxyCodeLine{1045     \textcolor{keywordflow}{if} (file < 0 \&\& (errno == EAGAIN || errno == EINTR))}
\DoxyCodeLine{1046         \textcolor{keywordflow}{goto} retry\_open;}
\DoxyCodeLine{1047     \textcolor{keywordflow}{if} (file < 0 || fstat(file, \&st) < 0)}
\DoxyCodeLine{1048     \{}
\DoxyCodeLine{1049         close(file);}
\DoxyCodeLine{1050         \textcolor{keywordflow}{return} MP3D\_E\_IOERROR;}
\DoxyCodeLine{1051     \}}
\DoxyCodeLine{1052 }
\DoxyCodeLine{1053     map\_info-\/>size = st.st\_size;}
\DoxyCodeLine{1054 retry\_mmap:}
\DoxyCodeLine{1055     map\_info-\/>buffer = (\textcolor{keyword}{const} uint8\_t *)mmap(NULL, st.st\_size, PROT\_READ, MAP\_PRIVATE | MAP\_POPULATE, file, 0);}
\DoxyCodeLine{1056     \textcolor{keywordflow}{if} (MAP\_FAILED == map\_info-\/>buffer \&\& (errno == EAGAIN || errno == EINTR))}
\DoxyCodeLine{1057         \textcolor{keywordflow}{goto} retry\_mmap;}
\DoxyCodeLine{1058     close(file);}
\DoxyCodeLine{1059     \textcolor{keywordflow}{if} (MAP\_FAILED == map\_info-\/>buffer)}
\DoxyCodeLine{1060         \textcolor{keywordflow}{return} MP3D\_E\_IOERROR;}
\DoxyCodeLine{1061     \textcolor{keywordflow}{return} 0;}
\DoxyCodeLine{1062 \}}
\DoxyCodeLine{1063 }
\DoxyCodeLine{1064 \textcolor{preprocessor}{\#if MINIMP3\_ENABLE\_RING \&\& defined(\_\_linux\_\_) \&\& defined(\_GNU\_SOURCE)}}
\DoxyCodeLine{1065 \textcolor{preprocessor}{\#define MINIMP3\_HAVE\_RING}}
\DoxyCodeLine{1066 \textcolor{keyword}{static} \textcolor{keywordtype}{void} mp3dec\_close\_ring(\mbox{\hyperlink{structmp3dec__map__info__t}{mp3dec\_map\_info\_t}} *map\_info)}
\DoxyCodeLine{1067 \{}
\DoxyCodeLine{1068 \textcolor{preprocessor}{\#if defined(\_\_linux\_\_) \&\& defined(\_GNU\_SOURCE)}}
\DoxyCodeLine{1069     \textcolor{keywordflow}{if} (map\_info-\/>buffer \&\& MAP\_FAILED != map\_info-\/>buffer)}
\DoxyCodeLine{1070         munmap((\textcolor{keywordtype}{void} *)map\_info-\/>buffer, map\_info-\/>size*2);}
\DoxyCodeLine{1071 \textcolor{preprocessor}{\#else}}
\DoxyCodeLine{1072     \textcolor{keywordflow}{if} (map\_info-\/>buffer)}
\DoxyCodeLine{1073     \{}
\DoxyCodeLine{1074         shmdt(map\_info-\/>buffer);}
\DoxyCodeLine{1075         shmdt(map\_info-\/>buffer + map\_info-\/>size);}
\DoxyCodeLine{1076     \}}
\DoxyCodeLine{1077 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{1078     map\_info-\/>buffer = 0;}
\DoxyCodeLine{1079     map\_info-\/>size   = 0;}
\DoxyCodeLine{1080 \}}
\DoxyCodeLine{1081 }
\DoxyCodeLine{1082 \textcolor{keyword}{static} \textcolor{keywordtype}{int} mp3dec\_open\_ring(\mbox{\hyperlink{structmp3dec__map__info__t}{mp3dec\_map\_info\_t}} *map\_info, \textcolor{keywordtype}{size\_t} size)}
\DoxyCodeLine{1083 \{}
\DoxyCodeLine{1084     \textcolor{keywordtype}{int} memfd, page\_size;}
\DoxyCodeLine{1085 \textcolor{preprocessor}{\#if defined(\_\_linux\_\_) \&\& defined(\_GNU\_SOURCE)}}
\DoxyCodeLine{1086     \textcolor{keywordtype}{void} *buffer;}
\DoxyCodeLine{1087     \textcolor{keywordtype}{int} res;}
\DoxyCodeLine{1088 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{1089     memset(map\_info, 0, \textcolor{keyword}{sizeof}(*map\_info));}
\DoxyCodeLine{1090 }
\DoxyCodeLine{1091 \textcolor{preprocessor}{\#ifdef \_SC\_PAGESIZE}}
\DoxyCodeLine{1092     page\_size = sysconf(\_SC\_PAGESIZE);}
\DoxyCodeLine{1093 \textcolor{preprocessor}{\#else}}
\DoxyCodeLine{1094     page\_size = getpagesize();}
\DoxyCodeLine{1095 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{1096     map\_info-\/>size = (size + page\_size -\/ 1)/page\_size*page\_size;}
\DoxyCodeLine{1097 }
\DoxyCodeLine{1098 \textcolor{preprocessor}{\#if defined(\_\_linux\_\_) \&\& defined(\_GNU\_SOURCE)}}
\DoxyCodeLine{1099     memfd = memfd\_create(\textcolor{stringliteral}{"{}mp3\_ring"{}}, 0);}
\DoxyCodeLine{1100     \textcolor{keywordflow}{if} (memfd < 0)}
\DoxyCodeLine{1101         \textcolor{keywordflow}{return} MP3D\_E\_MEMORY;}
\DoxyCodeLine{1102 }
\DoxyCodeLine{1103 retry\_ftruncate:}
\DoxyCodeLine{1104     res = ftruncate(memfd, map\_info-\/>size);}
\DoxyCodeLine{1105     \textcolor{keywordflow}{if} (res \&\& (errno == EAGAIN || errno == EINTR))}
\DoxyCodeLine{1106         \textcolor{keywordflow}{goto} retry\_ftruncate;}
\DoxyCodeLine{1107     \textcolor{keywordflow}{if} (res)}
\DoxyCodeLine{1108         \textcolor{keywordflow}{goto} error;}
\DoxyCodeLine{1109 }
\DoxyCodeLine{1110 retry\_mmap:}
\DoxyCodeLine{1111     map\_info-\/>buffer = (\textcolor{keyword}{const} uint8\_t *)mmap(NULL, map\_info-\/>size*2, PROT\_NONE, MAP\_ANONYMOUS | MAP\_PRIVATE, -\/1, 0);}
\DoxyCodeLine{1112     \textcolor{keywordflow}{if} (MAP\_FAILED == map\_info-\/>buffer \&\& (errno == EAGAIN || errno == EINTR))}
\DoxyCodeLine{1113         \textcolor{keywordflow}{goto} retry\_mmap;}
\DoxyCodeLine{1114     \textcolor{keywordflow}{if} (MAP\_FAILED == map\_info-\/>buffer || !map\_info-\/>buffer)}
\DoxyCodeLine{1115         \textcolor{keywordflow}{goto} error;}
\DoxyCodeLine{1116 retry\_mmap2:}
\DoxyCodeLine{1117     buffer = mmap((\textcolor{keywordtype}{void} *)map\_info-\/>buffer, map\_info-\/>size, PROT\_READ | PROT\_WRITE, MAP\_FIXED | MAP\_SHARED, memfd, 0);}
\DoxyCodeLine{1118     \textcolor{keywordflow}{if} (MAP\_FAILED == map\_info-\/>buffer \&\& (errno == EAGAIN || errno == EINTR))}
\DoxyCodeLine{1119         \textcolor{keywordflow}{goto} retry\_mmap2;}
\DoxyCodeLine{1120     \textcolor{keywordflow}{if} (MAP\_FAILED == map\_info-\/>buffer || buffer != (\textcolor{keywordtype}{void} *)map\_info-\/>buffer)}
\DoxyCodeLine{1121         \textcolor{keywordflow}{goto} error;}
\DoxyCodeLine{1122 retry\_mmap3:}
\DoxyCodeLine{1123     buffer = mmap((\textcolor{keywordtype}{void} *)map\_info-\/>buffer + map\_info-\/>size, map\_info-\/>size, PROT\_READ | PROT\_WRITE, MAP\_FIXED | MAP\_SHARED, memfd, 0);}
\DoxyCodeLine{1124     \textcolor{keywordflow}{if} (MAP\_FAILED == map\_info-\/>buffer \&\& (errno == EAGAIN || errno == EINTR))}
\DoxyCodeLine{1125         \textcolor{keywordflow}{goto} retry\_mmap3;}
\DoxyCodeLine{1126     \textcolor{keywordflow}{if} (MAP\_FAILED == map\_info-\/>buffer || buffer != (\textcolor{keywordtype}{void} *)(map\_info-\/>buffer + map\_info-\/>size))}
\DoxyCodeLine{1127         \textcolor{keywordflow}{goto} error;}
\DoxyCodeLine{1128 }
\DoxyCodeLine{1129     close(memfd);}
\DoxyCodeLine{1130     \textcolor{keywordflow}{return} 0;}
\DoxyCodeLine{1131 error:}
\DoxyCodeLine{1132     close(memfd);}
\DoxyCodeLine{1133     mp3dec\_close\_ring(map\_info);}
\DoxyCodeLine{1134     \textcolor{keywordflow}{return} MP3D\_E\_MEMORY;}
\DoxyCodeLine{1135 \textcolor{preprocessor}{\#else}}
\DoxyCodeLine{1136     memfd = shmget(IPC\_PRIVATE, map\_info-\/>size, IPC\_CREAT | 0700);}
\DoxyCodeLine{1137     \textcolor{keywordflow}{if} (memfd < 0)}
\DoxyCodeLine{1138         \textcolor{keywordflow}{return} MP3D\_E\_MEMORY;}
\DoxyCodeLine{1139 retry\_mmap:}
\DoxyCodeLine{1140     map\_info-\/>buffer = (\textcolor{keyword}{const} uint8\_t *)mmap(NULL, map\_info-\/>size*2, PROT\_NONE, MAP\_PRIVATE, -\/1, 0);}
\DoxyCodeLine{1141     \textcolor{keywordflow}{if} (MAP\_FAILED == map\_info-\/>buffer \&\& (errno == EAGAIN || errno == EINTR))}
\DoxyCodeLine{1142         \textcolor{keywordflow}{goto} retry\_mmap;}
\DoxyCodeLine{1143     \textcolor{keywordflow}{if} (MAP\_FAILED == map\_info-\/>buffer)}
\DoxyCodeLine{1144         \textcolor{keywordflow}{goto} error;}
\DoxyCodeLine{1145     \textcolor{keywordflow}{if} (map\_info-\/>buffer != shmat(memfd, map\_info-\/>buffer, 0))}
\DoxyCodeLine{1146         \textcolor{keywordflow}{goto} error;}
\DoxyCodeLine{1147     \textcolor{keywordflow}{if} ((map\_info-\/>buffer + map\_info-\/>size) != shmat(memfd, map\_info-\/>buffer + map\_info-\/>size, 0))}
\DoxyCodeLine{1148         \textcolor{keywordflow}{goto} error;}
\DoxyCodeLine{1149     \textcolor{keywordflow}{if} (shmctl(memfd, IPC\_RMID, NULL) < 0)}
\DoxyCodeLine{1150         \textcolor{keywordflow}{return} MP3D\_E\_MEMORY;}
\DoxyCodeLine{1151     \textcolor{keywordflow}{return} 0;}
\DoxyCodeLine{1152 error:}
\DoxyCodeLine{1153     shmctl(memfd, IPC\_RMID, NULL);}
\DoxyCodeLine{1154     mp3dec\_close\_ring(map\_info);}
\DoxyCodeLine{1155     \textcolor{keywordflow}{return} MP3D\_E\_MEMORY;}
\DoxyCodeLine{1156 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{1157 \}}
\DoxyCodeLine{1158 \textcolor{preprocessor}{\#endif }\textcolor{comment}{/*MINIMP3\_ENABLE\_RING*/}\textcolor{preprocessor}{}}
\DoxyCodeLine{1159 \textcolor{preprocessor}{\#elif defined(\_WIN32)}}
\DoxyCodeLine{1160 \textcolor{preprocessor}{\#include <windows.h>}}
\DoxyCodeLine{1161 }
\DoxyCodeLine{1162 \textcolor{keyword}{static} \textcolor{keywordtype}{void} mp3dec\_close\_file(\mbox{\hyperlink{structmp3dec__map__info__t}{mp3dec\_map\_info\_t}} *map\_info)}
\DoxyCodeLine{1163 \{}
\DoxyCodeLine{1164     \textcolor{keywordflow}{if} (map\_info-\/>buffer)}
\DoxyCodeLine{1165         UnmapViewOfFile(map\_info-\/>buffer);}
\DoxyCodeLine{1166     map\_info-\/>buffer = 0;}
\DoxyCodeLine{1167     map\_info-\/>size   = 0;}
\DoxyCodeLine{1168 \}}
\DoxyCodeLine{1169 }
\DoxyCodeLine{1170 \textcolor{keyword}{static} \textcolor{keywordtype}{int} mp3dec\_open\_file\_h(HANDLE file, \mbox{\hyperlink{structmp3dec__map__info__t}{mp3dec\_map\_info\_t}} *map\_info)}
\DoxyCodeLine{1171 \{}
\DoxyCodeLine{1172     memset(map\_info, 0, \textcolor{keyword}{sizeof}(*map\_info));}
\DoxyCodeLine{1173 }
\DoxyCodeLine{1174     HANDLE mapping = NULL;}
\DoxyCodeLine{1175     LARGE\_INTEGER s;}
\DoxyCodeLine{1176     s.LowPart = GetFileSize(file, (DWORD*)\&s.HighPart);}
\DoxyCodeLine{1177     \textcolor{keywordflow}{if} (s.LowPart == INVALID\_FILE\_SIZE \&\& GetLastError() != NO\_ERROR)}
\DoxyCodeLine{1178         \textcolor{keywordflow}{goto} error;}
\DoxyCodeLine{1179     map\_info-\/>size = s.QuadPart;}
\DoxyCodeLine{1180 }
\DoxyCodeLine{1181     mapping = CreateFileMapping(file, NULL, PAGE\_READONLY, 0, 0, NULL);}
\DoxyCodeLine{1182     \textcolor{keywordflow}{if} (!mapping)}
\DoxyCodeLine{1183         \textcolor{keywordflow}{goto} error;}
\DoxyCodeLine{1184     map\_info-\/>buffer = (\textcolor{keyword}{const} uint8\_t*)MapViewOfFile(mapping, FILE\_MAP\_READ, 0, 0, s.QuadPart);}
\DoxyCodeLine{1185     CloseHandle(mapping);}
\DoxyCodeLine{1186     \textcolor{keywordflow}{if} (!map\_info-\/>buffer)}
\DoxyCodeLine{1187         \textcolor{keywordflow}{goto} error;}
\DoxyCodeLine{1188 }
\DoxyCodeLine{1189     CloseHandle(file);}
\DoxyCodeLine{1190     \textcolor{keywordflow}{return} 0;}
\DoxyCodeLine{1191 error:}
\DoxyCodeLine{1192     mp3dec\_close\_file(map\_info);}
\DoxyCodeLine{1193     CloseHandle(file);}
\DoxyCodeLine{1194     \textcolor{keywordflow}{return} MP3D\_E\_IOERROR;}
\DoxyCodeLine{1195 \}}
\DoxyCodeLine{1196 }
\DoxyCodeLine{1197 \textcolor{keyword}{static} \textcolor{keywordtype}{int} mp3dec\_open\_file(\textcolor{keyword}{const} \textcolor{keywordtype}{char} *file\_name, \mbox{\hyperlink{structmp3dec__map__info__t}{mp3dec\_map\_info\_t}} *map\_info)}
\DoxyCodeLine{1198 \{}
\DoxyCodeLine{1199     \textcolor{keywordflow}{if} (!file\_name)}
\DoxyCodeLine{1200         \textcolor{keywordflow}{return} MP3D\_E\_PARAM;}
\DoxyCodeLine{1201     HANDLE file = CreateFileA(file\_name, GENERIC\_READ, FILE\_SHARE\_READ, 0, OPEN\_EXISTING, 0, 0);}
\DoxyCodeLine{1202     \textcolor{keywordflow}{if} (INVALID\_HANDLE\_VALUE == file)}
\DoxyCodeLine{1203         \textcolor{keywordflow}{return} MP3D\_E\_IOERROR;}
\DoxyCodeLine{1204     \textcolor{keywordflow}{return} mp3dec\_open\_file\_h(file, map\_info);}
\DoxyCodeLine{1205 \}}
\DoxyCodeLine{1206 }
\DoxyCodeLine{1207 \textcolor{keyword}{static} \textcolor{keywordtype}{int} mp3dec\_open\_file\_w(\textcolor{keyword}{const} \textcolor{keywordtype}{wchar\_t} *file\_name, \mbox{\hyperlink{structmp3dec__map__info__t}{mp3dec\_map\_info\_t}} *map\_info)}
\DoxyCodeLine{1208 \{}
\DoxyCodeLine{1209     \textcolor{keywordflow}{if} (!file\_name)}
\DoxyCodeLine{1210         \textcolor{keywordflow}{return} MP3D\_E\_PARAM;}
\DoxyCodeLine{1211     HANDLE file = CreateFileW(file\_name, GENERIC\_READ, FILE\_SHARE\_READ, 0, OPEN\_EXISTING, 0, 0);}
\DoxyCodeLine{1212     \textcolor{keywordflow}{if} (INVALID\_HANDLE\_VALUE == file)}
\DoxyCodeLine{1213         \textcolor{keywordflow}{return} MP3D\_E\_IOERROR;}
\DoxyCodeLine{1214     \textcolor{keywordflow}{return} mp3dec\_open\_file\_h(file, map\_info);}
\DoxyCodeLine{1215 \}}
\DoxyCodeLine{1216 \textcolor{preprocessor}{\#else}}
\DoxyCodeLine{1217 \textcolor{preprocessor}{\#include <stdio.h>}}
\DoxyCodeLine{1218 }
\DoxyCodeLine{1219 \textcolor{keyword}{static} \textcolor{keywordtype}{void} mp3dec\_close\_file(\mbox{\hyperlink{structmp3dec__map__info__t}{mp3dec\_map\_info\_t}} *map\_info)}
\DoxyCodeLine{1220 \{}
\DoxyCodeLine{1221     \textcolor{keywordflow}{if} (map\_info-\/>buffer)}
\DoxyCodeLine{1222         free((\textcolor{keywordtype}{void} *)map\_info-\/>buffer);}
\DoxyCodeLine{1223     map\_info-\/>buffer = 0;}
\DoxyCodeLine{1224     map\_info-\/>size = 0;}
\DoxyCodeLine{1225 \}}
\DoxyCodeLine{1226 }
\DoxyCodeLine{1227 \textcolor{keyword}{static} \textcolor{keywordtype}{int} mp3dec\_open\_file(\textcolor{keyword}{const} \textcolor{keywordtype}{char} *file\_name, \mbox{\hyperlink{structmp3dec__map__info__t}{mp3dec\_map\_info\_t}} *map\_info)}
\DoxyCodeLine{1228 \{}
\DoxyCodeLine{1229     \textcolor{keywordflow}{if} (!file\_name)}
\DoxyCodeLine{1230         \textcolor{keywordflow}{return} MP3D\_E\_PARAM;}
\DoxyCodeLine{1231     memset(map\_info, 0, \textcolor{keyword}{sizeof}(*map\_info));}
\DoxyCodeLine{1232     FILE *file = fopen(file\_name, \textcolor{stringliteral}{"{}rb"{}});}
\DoxyCodeLine{1233     \textcolor{keywordflow}{if} (!file)}
\DoxyCodeLine{1234         \textcolor{keywordflow}{return} MP3D\_E\_IOERROR;}
\DoxyCodeLine{1235     \textcolor{keywordtype}{int} res = MP3D\_E\_IOERROR;}
\DoxyCodeLine{1236     \textcolor{keywordtype}{long} size = -\/1;}
\DoxyCodeLine{1237     \textcolor{keywordflow}{if} (fseek(file, 0, SEEK\_END))}
\DoxyCodeLine{1238         \textcolor{keywordflow}{goto} error;}
\DoxyCodeLine{1239     size = ftell(file);}
\DoxyCodeLine{1240     \textcolor{keywordflow}{if} (size < 0)}
\DoxyCodeLine{1241         \textcolor{keywordflow}{goto} error;}
\DoxyCodeLine{1242     map\_info-\/>size = (size\_t)size;}
\DoxyCodeLine{1243     \textcolor{keywordflow}{if} (fseek(file, 0, SEEK\_SET))}
\DoxyCodeLine{1244         \textcolor{keywordflow}{goto} error;}
\DoxyCodeLine{1245     map\_info-\/>buffer = (uint8\_t *)malloc(map\_info-\/>size);}
\DoxyCodeLine{1246     \textcolor{keywordflow}{if} (!map\_info-\/>buffer)}
\DoxyCodeLine{1247     \{}
\DoxyCodeLine{1248         res = MP3D\_E\_MEMORY;}
\DoxyCodeLine{1249         \textcolor{keywordflow}{goto} error;}
\DoxyCodeLine{1250     \}}
\DoxyCodeLine{1251     \textcolor{keywordflow}{if} (fread((\textcolor{keywordtype}{void} *)map\_info-\/>buffer, 1, map\_info-\/>size, file) != map\_info-\/>size)}
\DoxyCodeLine{1252         \textcolor{keywordflow}{goto} error;}
\DoxyCodeLine{1253     fclose(file);}
\DoxyCodeLine{1254     \textcolor{keywordflow}{return} 0;}
\DoxyCodeLine{1255 error:}
\DoxyCodeLine{1256     mp3dec\_close\_file(map\_info);}
\DoxyCodeLine{1257     fclose(file);}
\DoxyCodeLine{1258     \textcolor{keywordflow}{return} res;}
\DoxyCodeLine{1259 \}}
\DoxyCodeLine{1260 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{1261 }
\DoxyCodeLine{1262 \textcolor{keyword}{static} \textcolor{keywordtype}{int} mp3dec\_detect\_mapinfo(\mbox{\hyperlink{structmp3dec__map__info__t}{mp3dec\_map\_info\_t}} *map\_info)}
\DoxyCodeLine{1263 \{}
\DoxyCodeLine{1264     \textcolor{keywordtype}{int} ret = mp3dec\_detect\_buf(map\_info-\/>buffer, map\_info-\/>size);}
\DoxyCodeLine{1265     mp3dec\_close\_file(map\_info);}
\DoxyCodeLine{1266     \textcolor{keywordflow}{return} ret;}
\DoxyCodeLine{1267 \}}
\DoxyCodeLine{1268 }
\DoxyCodeLine{1269 \textcolor{keyword}{static} \textcolor{keywordtype}{int} mp3dec\_load\_mapinfo(\mbox{\hyperlink{structmp3dec__t}{mp3dec\_t}} *dec, \mbox{\hyperlink{structmp3dec__map__info__t}{mp3dec\_map\_info\_t}} *map\_info, \mbox{\hyperlink{structmp3dec__file__info__t}{mp3dec\_file\_info\_t}} *info, MP3D\_PROGRESS\_CB progress\_cb, \textcolor{keywordtype}{void} *user\_data)}
\DoxyCodeLine{1270 \{}
\DoxyCodeLine{1271     \textcolor{keywordtype}{int} ret = mp3dec\_load\_buf(dec, map\_info-\/>buffer, map\_info-\/>size, info, progress\_cb, user\_data);}
\DoxyCodeLine{1272     mp3dec\_close\_file(map\_info);}
\DoxyCodeLine{1273     \textcolor{keywordflow}{return} ret;}
\DoxyCodeLine{1274 \}}
\DoxyCodeLine{1275 }
\DoxyCodeLine{1276 \textcolor{keyword}{static} \textcolor{keywordtype}{int} mp3dec\_iterate\_mapinfo(\mbox{\hyperlink{structmp3dec__map__info__t}{mp3dec\_map\_info\_t}} *map\_info, MP3D\_ITERATE\_CB callback, \textcolor{keywordtype}{void} *user\_data)}
\DoxyCodeLine{1277 \{}
\DoxyCodeLine{1278     \textcolor{keywordtype}{int} ret = mp3dec\_iterate\_buf(map\_info-\/>buffer, map\_info-\/>size, callback, user\_data);}
\DoxyCodeLine{1279     mp3dec\_close\_file(map\_info);}
\DoxyCodeLine{1280     \textcolor{keywordflow}{return} ret;}
\DoxyCodeLine{1281 \}}
\DoxyCodeLine{1282 }
\DoxyCodeLine{1283 \textcolor{keyword}{static} \textcolor{keywordtype}{int} mp3dec\_ex\_open\_mapinfo(\mbox{\hyperlink{structmp3dec__ex__t}{mp3dec\_ex\_t}} *dec, \textcolor{keywordtype}{int} flags)}
\DoxyCodeLine{1284 \{}
\DoxyCodeLine{1285     \textcolor{keywordtype}{int} ret = mp3dec\_ex\_open\_buf(dec, dec-\/>file.buffer, dec-\/>file.size, flags);}
\DoxyCodeLine{1286     dec-\/>is\_file = 1;}
\DoxyCodeLine{1287     \textcolor{keywordflow}{if} (ret)}
\DoxyCodeLine{1288         mp3dec\_ex\_close(dec);}
\DoxyCodeLine{1289     \textcolor{keywordflow}{return} ret;}
\DoxyCodeLine{1290 \}}
\DoxyCodeLine{1291 }
\DoxyCodeLine{1292 \textcolor{keywordtype}{int} mp3dec\_detect(\textcolor{keyword}{const} \textcolor{keywordtype}{char} *file\_name)}
\DoxyCodeLine{1293 \{}
\DoxyCodeLine{1294     \textcolor{keywordtype}{int} ret;}
\DoxyCodeLine{1295     \mbox{\hyperlink{structmp3dec__map__info__t}{mp3dec\_map\_info\_t}} map\_info;}
\DoxyCodeLine{1296     \textcolor{keywordflow}{if} ((ret = mp3dec\_open\_file(file\_name, \&map\_info)))}
\DoxyCodeLine{1297         \textcolor{keywordflow}{return} ret;}
\DoxyCodeLine{1298     \textcolor{keywordflow}{return} mp3dec\_detect\_mapinfo(\&map\_info);}
\DoxyCodeLine{1299 \}}
\DoxyCodeLine{1300 }
\DoxyCodeLine{1301 \textcolor{keywordtype}{int} mp3dec\_load(\mbox{\hyperlink{structmp3dec__t}{mp3dec\_t}} *dec, \textcolor{keyword}{const} \textcolor{keywordtype}{char} *file\_name, \mbox{\hyperlink{structmp3dec__file__info__t}{mp3dec\_file\_info\_t}} *info, MP3D\_PROGRESS\_CB progress\_cb, \textcolor{keywordtype}{void} *user\_data)}
\DoxyCodeLine{1302 \{}
\DoxyCodeLine{1303     \textcolor{keywordtype}{int} ret;}
\DoxyCodeLine{1304     \mbox{\hyperlink{structmp3dec__map__info__t}{mp3dec\_map\_info\_t}} map\_info;}
\DoxyCodeLine{1305     \textcolor{keywordflow}{if} ((ret = mp3dec\_open\_file(file\_name, \&map\_info)))}
\DoxyCodeLine{1306         \textcolor{keywordflow}{return} ret;}
\DoxyCodeLine{1307     \textcolor{keywordflow}{return} mp3dec\_load\_mapinfo(dec, \&map\_info, info, progress\_cb, user\_data);}
\DoxyCodeLine{1308 \}}
\DoxyCodeLine{1309 }
\DoxyCodeLine{1310 \textcolor{keywordtype}{int} mp3dec\_iterate(\textcolor{keyword}{const} \textcolor{keywordtype}{char} *file\_name, MP3D\_ITERATE\_CB callback, \textcolor{keywordtype}{void} *user\_data)}
\DoxyCodeLine{1311 \{}
\DoxyCodeLine{1312     \textcolor{keywordtype}{int} ret;}
\DoxyCodeLine{1313     \mbox{\hyperlink{structmp3dec__map__info__t}{mp3dec\_map\_info\_t}} map\_info;}
\DoxyCodeLine{1314     \textcolor{keywordflow}{if} ((ret = mp3dec\_open\_file(file\_name, \&map\_info)))}
\DoxyCodeLine{1315         \textcolor{keywordflow}{return} ret;}
\DoxyCodeLine{1316     \textcolor{keywordflow}{return} mp3dec\_iterate\_mapinfo(\&map\_info, callback, user\_data);}
\DoxyCodeLine{1317 \}}
\DoxyCodeLine{1318 }
\DoxyCodeLine{1319 \textcolor{keywordtype}{int} mp3dec\_ex\_open(\mbox{\hyperlink{structmp3dec__ex__t}{mp3dec\_ex\_t}} *dec, \textcolor{keyword}{const} \textcolor{keywordtype}{char} *file\_name, \textcolor{keywordtype}{int} flags)}
\DoxyCodeLine{1320 \{}
\DoxyCodeLine{1321     \textcolor{keywordtype}{int} ret;}
\DoxyCodeLine{1322     \textcolor{keywordflow}{if} (!dec)}
\DoxyCodeLine{1323         \textcolor{keywordflow}{return} MP3D\_E\_PARAM;}
\DoxyCodeLine{1324     \textcolor{keywordflow}{if} ((ret = mp3dec\_open\_file(file\_name, \&dec-\/>file)))}
\DoxyCodeLine{1325         \textcolor{keywordflow}{return} ret;}
\DoxyCodeLine{1326     \textcolor{keywordflow}{return} mp3dec\_ex\_open\_mapinfo(dec, flags);}
\DoxyCodeLine{1327 \}}
\DoxyCodeLine{1328 }
\DoxyCodeLine{1329 \textcolor{keywordtype}{void} mp3dec\_ex\_close(\mbox{\hyperlink{structmp3dec__ex__t}{mp3dec\_ex\_t}} *dec)}
\DoxyCodeLine{1330 \{}
\DoxyCodeLine{1331 \textcolor{preprocessor}{\#ifdef MINIMP3\_HAVE\_RING}}
\DoxyCodeLine{1332     \textcolor{keywordflow}{if} (dec-\/>io)}
\DoxyCodeLine{1333         mp3dec\_close\_ring(\&dec-\/>file);}
\DoxyCodeLine{1334 \textcolor{preprocessor}{\#else}}
\DoxyCodeLine{1335     \textcolor{keywordflow}{if} (dec-\/>io \&\& dec-\/>file.buffer)}
\DoxyCodeLine{1336         free((\textcolor{keywordtype}{void}*)dec-\/>file.buffer);}
\DoxyCodeLine{1337 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{1338     \textcolor{keywordflow}{if} (dec-\/>is\_file)}
\DoxyCodeLine{1339         mp3dec\_close\_file(\&dec-\/>file);}
\DoxyCodeLine{1340     \textcolor{keywordflow}{if} (dec-\/>index.frames)}
\DoxyCodeLine{1341         free(dec-\/>index.frames);}
\DoxyCodeLine{1342     memset(dec, 0, \textcolor{keyword}{sizeof}(*dec));}
\DoxyCodeLine{1343 \}}
\DoxyCodeLine{1344 }
\DoxyCodeLine{1345 \textcolor{preprocessor}{\#ifdef \_WIN32}}
\DoxyCodeLine{1346 \textcolor{keywordtype}{int} mp3dec\_detect\_w(\textcolor{keyword}{const} \textcolor{keywordtype}{wchar\_t} *file\_name)}
\DoxyCodeLine{1347 \{}
\DoxyCodeLine{1348     \textcolor{keywordtype}{int} ret;}
\DoxyCodeLine{1349     \mbox{\hyperlink{structmp3dec__map__info__t}{mp3dec\_map\_info\_t}} map\_info;}
\DoxyCodeLine{1350     \textcolor{keywordflow}{if} ((ret = mp3dec\_open\_file\_w(file\_name, \&map\_info)))}
\DoxyCodeLine{1351         \textcolor{keywordflow}{return} ret;}
\DoxyCodeLine{1352     \textcolor{keywordflow}{return} mp3dec\_detect\_mapinfo(\&map\_info);}
\DoxyCodeLine{1353 \}}
\DoxyCodeLine{1354 }
\DoxyCodeLine{1355 \textcolor{keywordtype}{int} mp3dec\_load\_w(\mbox{\hyperlink{structmp3dec__t}{mp3dec\_t}} *dec, \textcolor{keyword}{const} \textcolor{keywordtype}{wchar\_t} *file\_name, \mbox{\hyperlink{structmp3dec__file__info__t}{mp3dec\_file\_info\_t}} *info, MP3D\_PROGRESS\_CB progress\_cb, \textcolor{keywordtype}{void} *user\_data)}
\DoxyCodeLine{1356 \{}
\DoxyCodeLine{1357     \textcolor{keywordtype}{int} ret;}
\DoxyCodeLine{1358     \mbox{\hyperlink{structmp3dec__map__info__t}{mp3dec\_map\_info\_t}} map\_info;}
\DoxyCodeLine{1359     \textcolor{keywordflow}{if} ((ret = mp3dec\_open\_file\_w(file\_name, \&map\_info)))}
\DoxyCodeLine{1360         \textcolor{keywordflow}{return} ret;}
\DoxyCodeLine{1361     \textcolor{keywordflow}{return} mp3dec\_load\_mapinfo(dec, \&map\_info, info, progress\_cb, user\_data);}
\DoxyCodeLine{1362 \}}
\DoxyCodeLine{1363 }
\DoxyCodeLine{1364 \textcolor{keywordtype}{int} mp3dec\_iterate\_w(\textcolor{keyword}{const} \textcolor{keywordtype}{wchar\_t} *file\_name, MP3D\_ITERATE\_CB callback, \textcolor{keywordtype}{void} *user\_data)}
\DoxyCodeLine{1365 \{}
\DoxyCodeLine{1366     \textcolor{keywordtype}{int} ret;}
\DoxyCodeLine{1367     \mbox{\hyperlink{structmp3dec__map__info__t}{mp3dec\_map\_info\_t}} map\_info;}
\DoxyCodeLine{1368     \textcolor{keywordflow}{if} ((ret = mp3dec\_open\_file\_w(file\_name, \&map\_info)))}
\DoxyCodeLine{1369         \textcolor{keywordflow}{return} ret;}
\DoxyCodeLine{1370     \textcolor{keywordflow}{return} mp3dec\_iterate\_mapinfo(\&map\_info, callback, user\_data);}
\DoxyCodeLine{1371 \}}
\DoxyCodeLine{1372 }
\DoxyCodeLine{1373 \textcolor{keywordtype}{int} mp3dec\_ex\_open\_w(\mbox{\hyperlink{structmp3dec__ex__t}{mp3dec\_ex\_t}} *dec, \textcolor{keyword}{const} \textcolor{keywordtype}{wchar\_t} *file\_name, \textcolor{keywordtype}{int} flags)}
\DoxyCodeLine{1374 \{}
\DoxyCodeLine{1375     \textcolor{keywordtype}{int} ret;}
\DoxyCodeLine{1376     \textcolor{keywordflow}{if} ((ret = mp3dec\_open\_file\_w(file\_name, \&dec-\/>file)))}
\DoxyCodeLine{1377         \textcolor{keywordflow}{return} ret;}
\DoxyCodeLine{1378     \textcolor{keywordflow}{return} mp3dec\_ex\_open\_mapinfo(dec, flags);}
\DoxyCodeLine{1379 \}}
\DoxyCodeLine{1380 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{1381 \textcolor{preprocessor}{\#else }\textcolor{comment}{/* MINIMP3\_NO\_STDIO */}\textcolor{preprocessor}{}}
\DoxyCodeLine{1382 \textcolor{keywordtype}{void} mp3dec\_ex\_close(\mbox{\hyperlink{structmp3dec__ex__t}{mp3dec\_ex\_t}} *dec)}
\DoxyCodeLine{1383 \{}
\DoxyCodeLine{1384 \textcolor{preprocessor}{\#ifdef MINIMP3\_HAVE\_RING}}
\DoxyCodeLine{1385     \textcolor{keywordflow}{if} (dec-\/>io)}
\DoxyCodeLine{1386         mp3dec\_close\_ring(\&dec-\/>file);}
\DoxyCodeLine{1387 \textcolor{preprocessor}{\#else}}
\DoxyCodeLine{1388     \textcolor{keywordflow}{if} (dec-\/>io \&\& dec-\/>file.buffer)}
\DoxyCodeLine{1389         free((\textcolor{keywordtype}{void}*)dec-\/>file.buffer);}
\DoxyCodeLine{1390 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{1391     \textcolor{keywordflow}{if} (dec-\/>index.frames)}
\DoxyCodeLine{1392         free(dec-\/>index.frames);}
\DoxyCodeLine{1393     memset(dec, 0, \textcolor{keyword}{sizeof}(*dec));}
\DoxyCodeLine{1394 \}}
\DoxyCodeLine{1395 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{1396 }
\DoxyCodeLine{1397 \textcolor{preprocessor}{\#endif }\textcolor{comment}{/* MINIMP3\_IMPLEMENTATION \&\& !\_MINIMP3\_EX\_IMPLEMENTATION\_GUARD */}\textcolor{preprocessor}{}}

\end{DoxyCode}
